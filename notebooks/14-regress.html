
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Linear Models: Regression &#8212; TheMulQuaBio</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Linear Models: Analysis of variance" href="15-anova.html" />
    <link rel="prev" title="Basic hypothesis testing: \(t\) and \(F\) tests" href="13-t_F_tests.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">TheMulQuaBio</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to The Multilingual Quantitative Biologist!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Computing
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01-Unix.html">
   UNIX and Linux
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02-ShellScripting.html">
   Shell scripting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03-Git.html">
   Version control with Git
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04-LaTeX.html">
   Scientific documents with
   <span class="math notranslate nohighlight">
    \(\LaTeX\)
   </span>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05-Python_I.html">
   Biological Computing in Python I
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07-R.html">
   Biological Computing in R
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06-Python_II.html">
   Biological Computing in Python II
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Basic Data Analyses and Statistics
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats-Intro.html">
   Introduction to this section
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08-Data_R.html">
   Data Management and Visualization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="12-ExpDesign.html">
   Experimental design and Data exploration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="13-t_F_tests.html">
   Basic hypothesis testing:
   <span class="math notranslate nohighlight">
    \(t\)
   </span>
   and
   <span class="math notranslate nohighlight">
    \(F\)
   </span>
   tests
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Linear Models: Regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="15-anova.html">
   Linear Models: Analysis of variance
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="16-MulExpl.html">
   Linear Models: Multiple explanatory variables
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="17-MulExplInter.html">
   Linear Models: Multiple variables with interactions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="18-ModelSimp.html">
   Model simplification
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Advanced Data Analyses and Statistics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="19-glm.html">
   Generalised Linear Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="20-ModelFitting-NLLS.html">
   Model Fitting using Non-linear Least-squares
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Appendices
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Appendix-JupyIntro.html">
   Introduction to Jupyter
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Appendix-Data-Python.html">
   Data analyses  with Python &amp; Jupyter
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Appendix-Maths.html">
   Mathematical models in Jupyter
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Appendix-Databases.html">
   Databases
   <span class="tocSkip">
   </span>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Appendix-NLLS-Python.html">
   Model fitting in Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Appendix-MiniProj.html">
   The Computing Miniproject
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Appendix-Assessment.html">
   Coursework Assessment
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/mhasoba/TheMulQuaBio/master?urlpath=tree/notebooks/14-regress.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/mhasoba/TheMulQuaBio"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/mhasoba/TheMulQuaBio/issues/new?title=Issue%20on%20page%20%2Fnotebooks/14-regress.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/notebooks/14-regress.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exploring-the-data">
   Exploring the data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#correlations">
   Correlations
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#correlations-in-r">
     Correlations in R
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#transformations-and-allometric-scaling">
   Transformations and allometric scaling
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#performing-the-regression-analysis">
   Performing the Regression analysis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fitting-the-model">
     Fitting the model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#running-an-anova-on-the-fitted-model">
     Running an ANOVA on the fitted model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-sums-of-squares">
     The Sums of Squares
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise">
     Exercise
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plotting-the-fitted-regression-model">
     Plotting the fitted Regression model
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-diagnostics">
   Model diagnostics
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reporting-the-model">
   Reporting the model
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Linear Models: Regression</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exploring-the-data">
   Exploring the data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#correlations">
   Correlations
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#correlations-in-r">
     Correlations in R
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#transformations-and-allometric-scaling">
   Transformations and allometric scaling
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#performing-the-regression-analysis">
   Performing the Regression analysis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fitting-the-model">
     Fitting the model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#running-an-anova-on-the-fitted-model">
     Running an ANOVA on the fitted model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-sums-of-squares">
     The Sums of Squares
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise">
     Exercise
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plotting-the-fitted-regression-model">
     Plotting the fitted Regression model
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-diagnostics">
   Model diagnostics
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reporting-the-model">
   Reporting the model
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="linear-models-regression">
<h1>Linear Models: Regression<a class="headerlink" href="#linear-models-regression" title="Permalink to this headline">#</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">#</a></h2>
<p>Linear Regression is a class of <a class="reference external" href="https://en.wikipedia.org/wiki/Linear_model">Linear Models</a> that is frequently a good choice if both, your response (dependent) and your predictor (independent) variables are continuous. In this Chapter you will learn:</p>
<ul class="simple">
<li><p>To <em>explore</em> your data in order to determine whether a Linear Model is a good choice by</p>
<ul>
<li><p>Visualizing your data (in R)</p></li>
<li><p>Calculating correlations between variables</p></li>
</ul>
</li>
<li><p>To <em>fit</em> a Linear Regression Model to data</p></li>
<li><p>To determine whether the Model adequately fits your data (its “significance”), and also whether is it is at all an appropriate model for those data, by</p>
<ul>
<li><p>Plotting the data and the fitted Model together</p></li>
<li><p>Calculating goodness of fit measures and statistics</p></li>
<li><p>Using diagnostic plots</p></li>
</ul>
</li>
</ul>
<p>It is expected that you have already been introduced to, or are familiar with the concepts (and/or theory) underlying Linear Models. If not, you may want to see the <a class="reference external" href="https://github.com/mhasoba/TheMulQuaBio/tree/master/content/lectures/LinearModels">Linear Models lecture</a> (you can also watch the <a class="reference external" href="https://drive.google.com/drive/folders/12Sj56wHX6vcAnp9GE9qQ1gIXbn7QRHU2?usp=sharing">video</a>).</p>
<p>As with the previous chapters, we’ll start with creating a new blank script for you to fill in during the practical (the script file <code class="docutils literal notranslate"><span class="pre">regress.R</span></code> is also available from <a class="reference external" href="https://github.com/mhasoba/TheMulQuaBio/tree/master/content/code">TheMulQuaBio repository</a>).</p>
<p>We will use the genome size data (from the <a class="reference internal" href="13-t_F_tests.html"><span class="doc std std-doc">previous chapter</span></a>) again. So,</p>
<p>★ Open R and <code class="docutils literal notranslate"><span class="pre">setwd</span></code> to your <code class="docutils literal notranslate"><span class="pre">code</span></code> directory.</p>
<p>★ Create a new blank script called <code class="docutils literal notranslate"><span class="pre">Regression.R</span></code> and add some introductory comments.</p>
<p>★ Add code to your script to load the genome size data into R and check it (again, using the relative path prefix <code class="docutils literal notranslate"><span class="pre">../</span></code>, assuming that you working directory is <code class="docutils literal notranslate"><span class="pre">code</span></code>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">genome</span> <span class="o">&lt;-</span> <span class="nf">read.csv</span><span class="p">(</span><span class="s">&#39;../data/GenomeSize.csv&#39;</span><span class="p">,</span><span class="n">stringsAsFactors</span> <span class="o">=</span> <span class="bp">T</span><span class="p">)</span> 

<span class="nf">head</span><span class="p">(</span><span class="n">genome</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
<caption>A data.frame: 6 × 16</caption>
<thead>
	<tr><th></th><th scope=col>Suborder</th><th scope=col>Family</th><th scope=col>Species</th><th scope=col>GenomeSize</th><th scope=col>GenomeSE</th><th scope=col>GenomeN</th><th scope=col>BodyWeight</th><th scope=col>TotalLength</th><th scope=col>HeadLength</th><th scope=col>ThoraxLength</th><th scope=col>AdbdomenLength</th><th scope=col>ForewingLength</th><th scope=col>HindwingLength</th><th scope=col>ForewingArea</th><th scope=col>HindwingArea</th><th scope=col>MorphologyN</th></tr>
	<tr><th></th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>1</th><td>Anisoptera</td><td>Aeshnidae</td><td>Aeshna canadensis   </td><td>2.20</td><td>  NA</td><td>1</td><td>0.159</td><td>67.58</td><td>6.83</td><td>11.81</td><td>48.94</td><td>45.47</td><td>45.40</td><td>369.57</td><td>483.61</td><td>2</td></tr>
	<tr><th scope=row>2</th><td>Anisoptera</td><td>Aeshnidae</td><td>Aeshna constricta   </td><td>1.76</td><td>0.06</td><td>4</td><td>0.228</td><td>71.97</td><td>6.84</td><td>10.72</td><td>54.41</td><td>46.00</td><td>45.48</td><td>411.15</td><td>517.38</td><td>3</td></tr>
	<tr><th scope=row>3</th><td>Anisoptera</td><td>Aeshnidae</td><td>Aeshna eremita      </td><td>1.85</td><td>  NA</td><td>1</td><td>0.312</td><td>78.80</td><td>6.27</td><td>16.19</td><td>56.33</td><td>51.24</td><td>49.47</td><td>460.72</td><td>574.33</td><td>1</td></tr>
	<tr><th scope=row>4</th><td>Anisoptera</td><td>Aeshnidae</td><td>Aeshna tuberculifera</td><td>1.78</td><td>0.10</td><td>2</td><td>0.218</td><td>72.44</td><td>6.62</td><td>12.53</td><td>53.29</td><td>49.84</td><td>48.82</td><td>468.74</td><td>591.42</td><td>2</td></tr>
	<tr><th scope=row>5</th><td>Anisoptera</td><td>Aeshnidae</td><td>Aeshna umbrosa      </td><td>2.00</td><td>  NA</td><td>1</td><td>0.207</td><td>73.05</td><td>4.92</td><td>11.11</td><td>57.03</td><td>46.51</td><td>45.97</td><td>382.48</td><td>481.44</td><td>1</td></tr>
	<tr><th scope=row>6</th><td>Anisoptera</td><td>Aeshnidae</td><td>Aeshna verticalis   </td><td>1.59</td><td>  NA</td><td>1</td><td>0.220</td><td>66.25</td><td>6.48</td><td>11.64</td><td>48.13</td><td>45.91</td><td>44.91</td><td>400.40</td><td>486.97</td><td>1</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="exploring-the-data">
<h2>Exploring the data<a class="headerlink" href="#exploring-the-data" title="Permalink to this headline">#</a></h2>
<p>In previous chapters we used <code class="docutils literal notranslate"><span class="pre">plot</span></code> to create a scatterplot between two variables. If you have a set of variables to explore, writing code for each plot is tiresome, so R provides a function <code class="docutils literal notranslate"><span class="pre">pairs</span></code>, which creates a grid of scatter plots between each pair of variables. All it needs is a dataset.</p>
<p>First, plot all pairs:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">pairs</span><span class="p">(</span><span class="n">genome</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14-regress_6_0.png" src="../_images/14-regress_6_0.png" />
</div>
</div>
<p>That’s messy! There are too many columns that we are plotting against each other, so its hard to get a meaningful picture (literally). So let’s try color-coding the scatterplot markers by suborder:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">pairs</span><span class="p">(</span><span class="n">genome</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">genome</span><span class="o">$</span><span class="n">Suborder</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14-regress_8_0.png" src="../_images/14-regress_8_0.png" />
</div>
</div>
<p>The result is still too messy! There are far too many variables in <code class="docutils literal notranslate"><span class="pre">genome</span></code> for this to be useful. Before we proceed further,</p>
<p>★ Add <code class="docutils literal notranslate"><span class="pre">pairs(genome,</span> <span class="pre">col=genome$Suborder)</span></code> into your script and run the code:</p>
<p>So, we need to cut down the data to fewer variables. <a class="reference external" href="12-ExpDesign.ipynb#Explore-further-by-scatter-plotting-two-variables">Previously</a> we used <a class="reference internal" href="07-R.html#r-indices"><span class="std std-ref">indices</span></a> to select colours; here, we can use indices to select columns from the data frame. This again uses square brackets (<code class="docutils literal notranslate"><span class="pre">x[]</span></code>), but a data frame has two dimensions, rows and columns, so you need to provide an index for each dimension, separated by commas. If an index is left blank, then all of that dimension (i.e. all rows or columns) are selected.</p>
<p>Try the following to re-acquaint yourself to access data frame content using indices:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a small data frame:</span>
<span class="n">dat</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">A</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="s">&quot;c&quot;</span><span class="p">,</span> <span class="s">&quot;d&quot;</span><span class="p">,</span> <span class="s">&quot;e&quot;</span><span class="p">),</span> <span class="n">B</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">5</span><span class="p">))</span>
<span class="n">dat</span><span class="p">[</span><span class="m">1</span><span class="p">,</span> <span class="p">]</span> <span class="c1"># select row 1 (all columns selected)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
<caption>A data.frame: 1 × 2</caption>
<thead>
	<tr><th></th><th scope=col>A</th><th scope=col>B</th></tr>
	<tr><th></th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>1</th><td>a</td><td>1</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">dat</span><span class="p">[,</span> <span class="m">2</span><span class="p">]</span> <span class="c1"># select column 2 (all rows selected)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li></ol>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">dat</span><span class="p">[</span><span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">]</span> <span class="c1"># select row 2, column 1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">'b'</div></div>
</div>
<p>Now let’s get resume the actual analysis. We will look at five key variables: genome size, body weight, total length, forewing length and forewing area. If you look at the output of <code class="docutils literal notranslate"><span class="pre">str(genome)</span></code>, you’ll see that these are in columns 4, 7, 8, 12 and 14. We can record the indices of these columns and use this to select the data in the pairs plot:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">morpho_vars</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">12</span><span class="p">,</span> <span class="m">14</span><span class="p">)</span> <span class="c1"># store the indices</span>
<span class="nf">pairs</span><span class="p">(</span><span class="n">genome</span><span class="p">[,</span> <span class="n">morpho_vars</span><span class="p">],</span> <span class="n">col</span> <span class="o">=</span> <span class="n">genome</span><span class="o">$</span><span class="n">Suborder</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14-regress_15_0.png" src="../_images/14-regress_15_0.png" />
</div>
</div>
<p>★ Add the code above to your script and run it.</p>
<p>In the figure above, each scatterplot is shown twice, with the variables swapping between the <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> axes. You can see immediately that the relationships between the four morphological measurements and genome size are fairly scattered but that the plots comparing morphology show much clearer relationships.</p>
</section>
<section id="correlations">
<span id="regress-correlations"></span><h2>Correlations<a class="headerlink" href="#correlations" title="Permalink to this headline">#</a></h2>
<p>One way of summarising how strong the pair-wise relationship between any two variables is to calculate a <em>correlation coefficient</em> between them.</p>
<p>The Pearson correlation coefficient is the most commonly-used measure. It quantifies the <em>linear</em> correlation between two variables as the average of the product of the standardized values of the two variables (let’s call them <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span>):</p>
<div class="math notranslate nohighlight">
\[r_{xy}={\frac{\sum _{i=1}^{n}\left({\frac {x_{i}-{\bar {x}}}{s_{x}}}\right)\left({\frac {y_{i}-{\bar {y}}}{s_{y}}}\right)}{n-1}}\]</div>
<p>Here,</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(r_{xy}\)</span> is the correlation coefficient between the variables <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(n\)</span> is sample size</p></li>
<li><p><span class="math notranslate nohighlight">\(x_i, y_i\)</span> are the individual sample points indexed with <span class="math notranslate nohighlight">\(i\)</span> (<span class="math notranslate nohighlight">\(i = 1,2,\ldots, n\)</span>)</p></li>
<li><p><span class="math notranslate nohighlight">\(\bar{x} = \frac{\sum_{i=1}^n x_i}{n} \)</span> is the the sample mean (same as we learned <a class="reference internal" href="12-ExpDesign.html#expdesign-descriptive-statistics-in-r"><span class="std std-ref">before</span></a> and analogous calculation for <span class="math notranslate nohighlight">\(\bar{y}\)</span>)</p></li>
<li><p><span class="math notranslate nohighlight">\( s_x = \sqrt{ {\frac{\sum_{i=1}^n(x_i - \bar{x})^2}{n-1}}}\)</span> (sample standard deviation, again same as we learned <a class="reference internal" href="12-ExpDesign.html#expdesign-descriptive-statistics-in-r"><span class="std std-ref">before</span></a>)</p></li>
<li><p>The quantities <span class="math notranslate nohighlight">\(\left({\frac {x_{i}-{\bar {x}}}{s_{x}}}\right)\)</span> and <span class="math notranslate nohighlight">\(\left(\frac{y_i-\bar{y}}{s_y} \right)\)</span> are the Z-scores (aka <em>standard scores</em>) of <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span>. This conversion of the raw scores (<span class="math notranslate nohighlight">\(x_i\)</span>’s and <span class="math notranslate nohighlight">\(y_i\)</span>’s) to Z-scores is called standardizing (or sometimes, normalizing).</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Pearson correlation coefficient is a <em>parametric</em> statistic because it requires the <em>mean</em> of each variable, which is an <a class="reference internal" href="12-ExpDesign.html#expdesign-some-statistical-parlance"><span class="std std-ref"><em>estimated parameter</em></span></a>.</p>
</div>
<p>The calculation of the Pearson correlation coefficient is illustrated in <a class="reference internal" href="#pearson-c-c"><span class="std std-numref">Fig. 28</span></a>.</p>
<hr class="docutils" />
<figure class="align-default" id="pearson-c-c">
<a class="reference internal image-reference" href="../_images/corr.svg"><img alt="Pearson's Correlation Coefficient" src="../_images/corr.svg" width="800px" /></a>
<figcaption>
<p><span class="caption-number">Fig. 28 </span><span class="caption-text"><strong>Illustration of what the Pearson correlation coefficient means.</strong> It is calculated using the differences from the mean on each axis. The key calculation is —for each point— to get the product of the differences on each axis and add them up. The Pearson correlation coefficient simply scales these sums of <span class="math notranslate nohighlight">\(xy\)</span> to be between -1 (perfectly negatively correlated) and 1 (perfectly positively correlated) via zero (no correlation). If the points are mostly top left (<span class="math notranslate nohighlight">\(-x\)</span>, <span class="math notranslate nohighlight">\(y\)</span>) or bottom right (<span class="math notranslate nohighlight">\(x\)</span>, <span class="math notranslate nohighlight">\(-y\)</span>) then these products are mostly negative (<span class="math notranslate nohighlight">\(-xy\)</span>); if the points are mostly top right (<span class="math notranslate nohighlight">\(x\)</span>, <span class="math notranslate nohighlight">\(y\)</span>) or bottom left (<span class="math notranslate nohighlight">\(-x\)</span>, <span class="math notranslate nohighlight">\(-y\)</span>) then the products are mostly positive (<span class="math notranslate nohighlight">\(xy\)</span>).</span><a class="headerlink" href="#pearson-c-c" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<hr class="docutils" />
<p>The plots in in <a class="reference internal" href="#pearson-c-c"><span class="std std-numref">Fig. 28</span></a> show three clear cases where all the values of <span class="math notranslate nohighlight">\(xy\)</span> are negative or positive or where both are present and sum to zero. Thus the coefficient (<span class="math notranslate nohighlight">\(r_{xy}\)</span>) will be positive (negative) if the <span class="math notranslate nohighlight">\(x_i\)</span> and <span class="math notranslate nohighlight">\(y_i\)</span>’s tend to move in the same (opposite) direction relative to their respective means (as illustrated here).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>More technically, the Pearson correlation coefficient is a normalised measure of the <em>covariance</em> (such that it always takes a value between -1 and 1).</p>
</div>
<section id="correlations-in-r">
<h3>Correlations in R<a class="headerlink" href="#correlations-in-r" title="Permalink to this headline">#</a></h3>
<p>In R, we will use two functions to look at correlations. The first is <code class="docutils literal notranslate"><span class="pre">cor</span></code>, which can calculate correlations between pairs of variables, so is a good partner for <code class="docutils literal notranslate"><span class="pre">pairs</span></code> plots. The second is <code class="docutils literal notranslate"><span class="pre">cor.test</span></code>, which can only compare a single pair of variables, but uses a <span class="math notranslate nohighlight">\(t\)</span> test to assess whether the correlation is significant.</p>
<p><span class="math notranslate nohighlight">\(\star\)</span> Try the following (and include it in your R script file):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">cor</span><span class="p">(</span><span class="n">genome</span><span class="p">[,</span> <span class="n">morpho_vars</span><span class="p">],</span> <span class="n">use</span> <span class="o">=</span> <span class="s">&quot;pairwise&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
<caption>A matrix: 5 × 5 of type dbl</caption>
<thead>
	<tr><th></th><th scope=col>GenomeSize</th><th scope=col>BodyWeight</th><th scope=col>TotalLength</th><th scope=col>ForewingLength</th><th scope=col>ForewingArea</th></tr>
</thead>
<tbody>
	<tr><th scope=row>GenomeSize</th><td>1.0000000</td><td>0.3430934</td><td>0.3407077</td><td>0.2544432</td><td>0.3107247</td></tr>
	<tr><th scope=row>BodyWeight</th><td>0.3430934</td><td>1.0000000</td><td>0.9167995</td><td>0.8944228</td><td>0.9198821</td></tr>
	<tr><th scope=row>TotalLength</th><td>0.3407077</td><td>0.9167995</td><td>1.0000000</td><td>0.9225974</td><td>0.9077555</td></tr>
	<tr><th scope=row>ForewingLength</th><td>0.2544432</td><td>0.8944228</td><td>0.9225974</td><td>1.0000000</td><td>0.9829803</td></tr>
	<tr><th scope=row>ForewingArea</th><td>0.3107247</td><td>0.9198821</td><td>0.9077555</td><td>0.9829803</td><td>1.0000000</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>This is the correlation matrix. Then:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">cor.test</span><span class="p">(</span><span class="n">genome</span><span class="o">$</span><span class="n">GenomeSize</span><span class="p">,</span> <span class="n">genome</span><span class="o">$</span><span class="n">TotalLength</span><span class="p">,</span> <span class="n">use</span> <span class="o">=</span> <span class="s">&quot;pairwise&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	Pearson&#39;s product-moment correlation

data:  genome$GenomeSize and genome$TotalLength
t = 3.5507, df = 96, p-value = 0.0005972
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.1526035 0.5049895
sample estimates:
      cor 
0.3407077 
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">use='pairwise'</span></code> tells R to omit observations with missing data and use complete pairs of observations. The first function confirms our impressions from the graphs: the correlations between genome size and morphology are positive but comparatively weak and the correlations between morphological measurements are positive and very strong (i.e. close to 1). The correlation test tells us that genome size and body length are positively correlated (r=0.34, <span class="math notranslate nohighlight">\(t\)</span> = 3.5507, df = 96, <span class="math notranslate nohighlight">\(p\)</span> = 0.0006).</p>
<p><em>Remember this example when reporting correlations in your reports – all this information needs to be included</em></p>
<p>Also, in case you are wondering about what the t-value in the <code class="docutils literal notranslate"><span class="pre">cor.test</span></code> signifies:</p>
<p>The t-test is used within <code class="docutils literal notranslate"><span class="pre">cor.test</span></code> to establish if the correlation coefficient is significantly different from zero, that is, to test if there is a significant association between the two variables. If you recall from the previous Chapter, the t-test, in general, can be used to test if the mean of a sample is significantly different from some reference value (1-sample t-test). Here, the “mean of the sample” is the observed correlation coefficient, and the reference value is 0 (the null hypothesis, that there is no association).</p>
</section>
</section>
<section id="transformations-and-allometric-scaling">
<h2>Transformations and allometric scaling<a class="headerlink" href="#transformations-and-allometric-scaling" title="Permalink to this headline">#</a></h2>
<p>There is one problem with the correlations above: <em>the correlation coefficient calculation assumes a straight line relationship</em> (a linear correlation). Some of the scatterplots above are fairly straight but there are some strongly curved relationships. This is due to <a class="reference external" href="https://en.wikipedia.org/wiki/Allometry">allometric scaling</a>, where one body measure changes (or grows) disproportionately with respect to another. Here, two of the variables are in linear units (total and forewing length), one is in squared units (forewing area) and one in cubic units (body weight, which is approximately volume). That these measures are in different units itself guarantees that they will scale allometrically with respect to each other.</p>
<p>The relationships between these variables can be described using a power law:</p>
<div class="math notranslate nohighlight">
\[y = ax^b\]</div>
<p>Fortunately, if we log transform this equation, we get <span class="math notranslate nohighlight">\(\log(y) = \log(a) + b \log(x)\)</span>. This is the equation of a straight line (<span class="math notranslate nohighlight">\(y=a+bx\)</span>), so we should be able to make these plots straighter by logging both axes. We saw <a class="reference external" href="13-t_F_tests.ipynb#%24t%24-tests-revisited">previously</a> that we can create a new logged variable in the data frame like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">genome</span><span class="o">$</span><span class="n">logGS</span> <span class="o">&lt;-</span> <span class="nf">log</span><span class="p">(</span><span class="n">genome</span><span class="o">$</span><span class="n">GenomeSize</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>★ Using this command as a template, create a new logged version of the five
variables listed above:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">genome</span><span class="o">$</span><span class="n">logGS</span> <span class="o">&lt;-</span> <span class="nf">log</span><span class="p">(</span><span class="n">genome</span><span class="o">$</span><span class="n">GenomeSize</span><span class="p">)</span>
<span class="n">genome</span><span class="o">$</span><span class="n">logBW</span> <span class="o">&lt;-</span> <span class="nf">log</span><span class="p">(</span><span class="n">genome</span><span class="o">$</span><span class="n">BodyWeight</span><span class="p">)</span>
<span class="n">genome</span><span class="o">$</span><span class="n">logTL</span> <span class="o">&lt;-</span> <span class="nf">log</span><span class="p">(</span><span class="n">genome</span><span class="o">$</span><span class="n">TotalLength</span><span class="p">)</span>
<span class="n">genome</span><span class="o">$</span><span class="n">logFL</span> <span class="o">&lt;-</span> <span class="nf">log</span><span class="p">(</span><span class="n">genome</span><span class="o">$</span><span class="n">ForewingLength</span><span class="p">)</span>
<span class="n">genome</span><span class="o">$</span><span class="n">logFA</span> <span class="o">&lt;-</span> <span class="nf">log</span><span class="p">(</span><span class="n">genome</span><span class="o">$</span><span class="n">ForewingArea</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>★ Then, using <code class="docutils literal notranslate"><span class="pre">str</span></code>, work out which column numbers the logged variables are and create a new variable called <code class="docutils literal notranslate"><span class="pre">logmorpho</span></code> containing these numbers:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">str</span><span class="p">(</span><span class="n">genome</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;data.frame&#39;:	100 obs. of  21 variables:
 $ Suborder      : Factor w/ 2 levels &quot;Anisoptera&quot;,&quot;Zygoptera&quot;: 1 1 1 1 1 1 1 1 1 1 ...
 $ Family        : Factor w/ 9 levels &quot;Aeshnidae&quot;,&quot;Calopterygidae&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
 $ Species       : Factor w/ 100 levels &quot;Aeshna canadensis&quot;,..: 1 2 3 4 5 6 8 17 46 53 ...
 $ GenomeSize    : num  2.2 1.76 1.85 1.78 2 1.59 1.44 1.16 1.44 1.2 ...
 $ GenomeSE      : num  NA 0.06 NA 0.1 NA NA NA NA NA NA ...
 $ GenomeN       : int  1 4 1 2 1 1 1 1 1 1 ...
 $ BodyWeight    : num  0.159 0.228 0.312 0.218 0.207 0.22 0.344 0.128 0.392 0.029 ...
 $ TotalLength   : num  67.6 72 78.8 72.4 73 ...
 $ HeadLength    : num  6.83 6.84 6.27 6.62 4.92 6.48 7.53 5.74 8.05 5.28 ...
 $ ThoraxLength  : num  11.8 10.7 16.2 12.5 11.1 ...
 $ AdbdomenLength: num  48.9 54.4 56.3 53.3 57 ...
 $ ForewingLength: num  45.5 46 51.2 49.8 46.5 ...
 $ HindwingLength: num  45.4 45.5 49.5 48.8 46 ...
 $ ForewingArea  : num  370 411 461 469 382 ...
 $ HindwingArea  : num  484 517 574 591 481 ...
 $ MorphologyN   : int  2 3 1 2 1 1 4 1 1 1 ...
 $ logGS         : num  0.788 0.565 0.615 0.577 0.693 ...
 $ logBW         : num  -1.84 -1.48 -1.16 -1.52 -1.58 ...
 $ logTL         : num  4.21 4.28 4.37 4.28 4.29 ...
 $ logFL         : num  3.82 3.83 3.94 3.91 3.84 ...
 $ logFA         : num  5.91 6.02 6.13 6.15 5.95 ...
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">logmorpho</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">17</span><span class="p">,</span><span class="m">18</span><span class="p">,</span><span class="m">19</span><span class="p">,</span><span class="m">20</span><span class="p">,</span><span class="m">21</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can now use the <code class="docutils literal notranslate"><span class="pre">pairs</span></code> and <code class="docutils literal notranslate"><span class="pre">cor</span></code> test as before for the columns in <code class="docutils literal notranslate"><span class="pre">logmorpho</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">pairs</span><span class="p">(</span><span class="n">genome</span><span class="p">[,</span> <span class="n">logmorpho</span><span class="p">],</span> <span class="n">col</span><span class="o">=</span><span class="n">genome</span><span class="o">$</span><span class="n">Suborder</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14-regress_28_0.png" src="../_images/14-regress_28_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">cor</span><span class="p">(</span><span class="n">genome</span><span class="p">[,</span> <span class="n">logmorpho</span><span class="p">],</span> <span class="n">use</span><span class="o">=</span><span class="s">&#39;pairwise&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
<caption>A matrix: 5 × 5 of type dbl</caption>
<thead>
	<tr><th></th><th scope=col>logGS</th><th scope=col>logBW</th><th scope=col>logTL</th><th scope=col>logFL</th><th scope=col>logFA</th></tr>
</thead>
<tbody>
	<tr><th scope=row>logGS</th><td>1.00000000</td><td>0.08406293</td><td>0.2224443</td><td>0.1150025</td><td>0.06808306</td></tr>
	<tr><th scope=row>logBW</th><td>0.08406293</td><td>1.00000000</td><td>0.8891899</td><td>0.9456492</td><td>0.94995683</td></tr>
	<tr><th scope=row>logTL</th><td>0.22244431</td><td>0.88918989</td><td>1.0000000</td><td>0.9157695</td><td>0.86207098</td></tr>
	<tr><th scope=row>logFL</th><td>0.11500250</td><td>0.94564919</td><td>0.9157695</td><td>1.0000000</td><td>0.97916470</td></tr>
	<tr><th scope=row>logFA</th><td>0.06808306</td><td>0.94995683</td><td>0.8620710</td><td>0.9791647</td><td>1.00000000</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>The scatterplots show that logging the data has very successfully addressed curvature (non-linearity) due to allometric scaling between variables in the data.</p>
</section>
<section id="performing-the-regression-analysis">
<span id="regress-perform"></span><h2>Performing the Regression analysis<a class="headerlink" href="#performing-the-regression-analysis" title="Permalink to this headline">#</a></h2>
<p>We’ll now look at fitting the first linear model of this course, to explore whether log genome size explains log body weight. The first thing to do is to plot the data (as you did <a class="reference external" href="12-ExpDesign.ipynb#Explore-further-by-scatter-plotting-two-variables">previously</a>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">myColours</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;red&#39;</span><span class="p">,</span> <span class="s">&#39;blue&#39;</span><span class="p">)</span> <span class="c1"># Choose two colours</span>
<span class="n">mySymbols</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">)</span> <span class="c1"># And two different markers</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">genome</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>'Suborder'</li><li>'Family'</li><li>'Species'</li><li>'GenomeSize'</li><li>'GenomeSE'</li><li>'GenomeN'</li><li>'BodyWeight'</li><li>'TotalLength'</li><li>'HeadLength'</li><li>'ThoraxLength'</li><li>'AdbdomenLength'</li><li>'ForewingLength'</li><li>'HindwingLength'</li><li>'ForewingArea'</li><li>'HindwingArea'</li><li>'MorphologyN'</li><li>'logGS'</li><li>'logBW'</li><li>'logTL'</li><li>'logFL'</li><li>'logFA'</li></ol>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">plot</span><span class="p">(</span><span class="n">logBW</span> <span class="o">~</span> <span class="n">GenomeSize</span> <span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">genome</span><span class="p">,</span> <span class="c1">#Now plot again</span>
<span class="n">col</span> <span class="o">=</span> <span class="n">myColours</span><span class="p">[</span><span class="n">Suborder</span><span class="p">],</span> <span class="n">pch</span> <span class="o">=</span> <span class="n">mySymbols</span><span class="p">[</span><span class="n">Suborder</span><span class="p">],</span>
<span class="n">xlab</span><span class="o">=</span><span class="s">&#39;Genome size (pg)&#39;</span><span class="p">,</span> <span class="n">ylab</span><span class="o">=</span><span class="s">&#39;log(Body weight) (mg)&#39;</span><span class="p">)</span>

<span class="nf">legend</span><span class="p">(</span><span class="s">&quot;topleft&quot;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="nf">levels</span><span class="p">(</span><span class="n">genome</span><span class="o">$</span><span class="n">Suborder</span><span class="p">),</span> <span class="c1">#Add legend at top left corner</span>
       <span class="n">col</span><span class="o">=</span> <span class="n">myColours</span><span class="p">,</span> <span class="n">pch</span> <span class="o">=</span> <span class="n">mySymbols</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14-regress_33_0.png" src="../_images/14-regress_33_0.png" />
</div>
</div>
<p>It is clear that the two suborders have very different relationships: to begin with we will look at dragonflies (Anisoptera).</p>
<section id="fitting-the-model">
<h3>Fitting the model<a class="headerlink" href="#fitting-the-model" title="Permalink to this headline">#</a></h3>
<p>We will fit the <strong>the linear (Regression) model</strong></p>
<p><span class="math notranslate nohighlight">\(y= \beta_1 + \beta_{2}x\)</span>,</p>
<p>i.e., a straight line relationship between the response variable and a continuous explanatory variable.</p>
<p>The code below fits this model:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">genomeSizeModelDragon</span> <span class="o">&lt;-</span> <span class="nf">lm</span><span class="p">(</span><span class="n">logBW</span> <span class="o">~</span> <span class="n">logGS</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">genome</span><span class="p">,</span> <span class="n">subset</span> <span class="o">=</span>  <span class="n">Suborder</span> <span class="o">==</span> <span class="s">&quot;Anisoptera&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>★ Add this model fitting command into your script and run it.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Note the long name (<code class="docutils literal notranslate"><span class="pre">nullModelDragon</span></code>) we used for the model. Short names are easier to type but calling R objects names like <code class="docutils literal notranslate"><span class="pre">mod1</span></code>, <code class="docutils literal notranslate"><span class="pre">mod2</span></code>, <code class="docutils literal notranslate"> <span class="pre">xxx</span></code> swiftly get confusing, so try and keep model names as explicit as possible.</p>
</div>
<p>Now we want to look at the output of the model. Remember from the lecture that a model has <em>coefficients</em> (the <span class="math notranslate nohighlight">\(\beta\)</span> values in the equation of the model) and <em>terms</em> which are the explanatory variables in the model. We’ll look at the <em>coefficients</em> first:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">coef</span><span class="p">(</span><span class="n">genomeSizeModelDragon</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.dl-inline {width: auto; margin:0; padding: 0}
.dl-inline>dt, .dl-inline>dd {float: none; width: auto; display: inline-block}
.dl-inline>dt::after {content: ":\0020"; padding-right: .5ex}
.dl-inline>dt:not(:first-of-type) {padding-left: .5ex}
</style><dl class=dl-inline><dt>(Intercept)</dt><dd>-2.39947139744339</dd><dt>logGS</dt><dd>1.00522047426408</dd></dl>
</div></div>
</div>
<p>But we need more information to assess the <em>goodness-of-fit</em> of this model. So let’s this info by using the <code class="docutils literal notranslate"><span class="pre">summary()</span></code> function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">summary</span><span class="p">(</span><span class="n">genomeSizeModelDragon</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
lm(formula = logBW ~ logGS, data = genome, subset = Suborder == 
    &quot;Anisoptera&quot;)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.3243 -0.6124  0.0970  0.5194  1.3236 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -2.39947    0.09085 -26.413  &lt; 2e-16 ***
logGS        1.00522    0.23975   4.193 9.54e-05 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.6966 on 58 degrees of freedom
  (2 observations deleted due to missingness)
Multiple R-squared:  0.2326,	Adjusted R-squared:  0.2194 
F-statistic: 17.58 on 1 and 58 DF,  p-value: 9.539e-05
</pre></div>
</div>
</div>
</div>
<p>There is a lot of information there: the model description (”<code class="docutils literal notranslate"><span class="pre">Call</span></code>”), a summary of the residuals, a table of coefficients and then information on residual standard error, R<span class="math notranslate nohighlight">\(^2\)</span>, and a <span class="math notranslate nohighlight">\(F\)</span> test.</p>
<p>All of these will become clearer during this course (in particular, the meaning of Adjusted R-square will be explained in the <a class="reference internal" href="15-anova.html"><span class="doc std std-doc">ANOVA chapter</span></a>) — for the moment, concentrate on the coefficients table:</p>
<ul class="simple">
<li><p>There are two rows in the coefficient table, one for each coefficient in <span class="math notranslate nohighlight">\(y=\beta_1 + \beta_2x\)</span> — these are the intercept and the slope of the line. The rest the details on each row are a <span class="math notranslate nohighlight">\(t\)</span>-test of whether the slope and intercept are significantly different from zero.</p>
<ul>
<li><p>The (least-squares) estimate of the slope coefficient (<code class="docutils literal notranslate"><span class="pre">logGS</span></code>) is equal to the correlation coefficient between the dependent variable (<span class="math notranslate nohighlight">\(y\)</span>, here <code class="docutils literal notranslate"><span class="pre">logBW</span></code>) and the independent variable (<span class="math notranslate nohighlight">\(x\)</span>, here <code class="docutils literal notranslate"><span class="pre">logGS</span></code>) times the ratio of the (sample) standard deviations of the two (see <a class="reference external" href="#Correlations">above</a> for the definitions of these):</p></li>
</ul>
</li>
</ul>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*} 
    \text{Slope} = \beta_2 = r_{xy} \frac{s_y}{s_x}
\end{equation*}\]</div>
<p>Thus you can see that the regression slope is proportional to the correlation coefficient; the ratio of standard deviations serves to scale the correlation coefficient (which is unit-less) appropriately to the actual units in which the variables are measured.<br />
* The (least-squares) estimate of the intercept is the mean of the dependent variable minus the estimated slope coefficient times the mean of the independent variable:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*} 
    \text{Intercept} = \beta_1 = \bar{y} - \beta_2 \bar{x} 
\end{equation*}\]</div>
<p>OK, now for the other outputs:</p>
<ul class="simple">
<li><p>The standard error of the model (<code class="docutils literal notranslate"><span class="pre">Residual</span> <span class="pre">standard</span> <span class="pre">error</span></code> in the above output, also referred to as the “standard error of the regression”) is equal to the square root of the sum of the squared residuals divided by <span class="math notranslate nohighlight">\(n-2\)</span>. The sum of squared residuals is divided by <span class="math notranslate nohighlight">\(n-2\)</span> in this calculation rather than <span class="math notranslate nohighlight">\(n-1\)</span> because an additional degree of freedom for error has been used up by estimating two parameters (a slope and an intercept) rather than only one (the mean) in fitting the model to the data.</p></li>
<li><p>As you can see in the output above, each of the two model parameters, the slope and intercept, has its own standard error, and quantifies the uncertainty in these two estimates. These can be used to construct the Confidence Intervals around these estimates, which we will learn about later.</p></li>
</ul>
<p>The main take-away from all this is that the standard errors of the coefficients are directly proportional to the standard error of the regression and inversely proportional to the square root of the sample size (<span class="math notranslate nohighlight">\(n\)</span>). Thus, that “noise” in the data (measured by the residual standard error) affects the errors in the coefficient estimates in exactly the same way. Thus, 4 times as much data will tend to reduce the standard errors of the all coefficients by approximately a factor of 2.</p>
</section>
<section id="running-an-anova-on-the-fitted-model">
<h3>Running an ANOVA on the fitted model<a class="headerlink" href="#running-an-anova-on-the-fitted-model" title="Permalink to this headline">#</a></h3>
<p>Now we will look at the <em>terms</em> of the model using the <code class="docutils literal notranslate"><span class="pre">anova</span></code> function.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We will have a proper look at ANOVA (Analysis of Variance) as a linear model in itself <a class="reference internal" href="15-anova.html"><span class="doc std std-doc">in another chapter</span></a>.</p>
</div>
<p>ANOVA tests how much variation in the response variable is explained by each explanatory variable. We only have one variable and so there is only one row in the output:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">anova</span><span class="p">(</span><span class="n">genomeSizeModelDragon</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
<caption>A anova: 2 × 5</caption>
<thead>
	<tr><th></th><th scope=col>Df</th><th scope=col>Sum Sq</th><th scope=col>Mean Sq</th><th scope=col>F value</th><th scope=col>Pr(&gt;F)</th></tr>
	<tr><th></th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>logGS</th><td> 1</td><td> 8.52939</td><td>8.5293897</td><td>17.57907</td><td>9.538946e-05</td></tr>
	<tr><th scope=row>Residuals</th><td>58</td><td>28.14168</td><td>0.4852014</td><td>      NA</td><td>          NA</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>This table basically compares the variation in log body weight explained by log genome size to the total variation in log body weight. The five columns in the ANOVA table are:</p>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">Df</span></code></strong>: This shows the degrees of freedom. Each fitted parameter/coefficient takes up a degree of freedom from the total sample size. The leftover is the residuals degree of freedom. The model <span class="math notranslate nohighlight">\(y=\beta_1 + \beta_2x\)</span> — has two parameters, so the Resduals degrees of freedom is <span class="math notranslate nohighlight">\(60-2= 58\)</span>.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">Sum</span> <span class="pre">Sq</span></code></strong>: This shows sums of squares. The bottom line is the residual sum of squares (variation not explained) by the model and the one above (the <code class="docutils literal notranslate"><span class="pre">logGS</span></code> row) is the variation explained by genome size.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">Mean</span> <span class="pre">Sq</span></code></strong>: These are just the Sum Sq (Sum of Squares) values divided by the degrees of freedom. The idea behind this is simple: if we explain lots of variation with one coefficient, that is good (the null model), and if we explain a small amount of variation with a loss of degree of freedom (by adding and then estimating more parameters), then that is bad.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">F</span> <span class="pre">value</span></code></strong>: This is the ratio of the Mean Sq for the variable and the residual Mean Sq. This is used to test whether the explained variation is large or small.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">Pr(&gt;F)</span></code></strong>: This is the <span class="math notranslate nohighlight">\(p\)</span> value — the probability of the x-variable (the fitted model) explaining this much variance by chance.</p></li>
</ul>
<p>In this case, it is clear that genome size explains a significant variation in body weight.</p>
<p>★ Include the <code class="docutils literal notranslate"><span class="pre">summary</span></code> and <code class="docutils literal notranslate"><span class="pre">anova</span></code> commands for <code class="docutils literal notranslate"><span class="pre">genomeSizeModelDragon</span></code> in your script, run them and check you are happy with the output.</p>
</section>
<section id="the-sums-of-squares">
<h3>The Sums of Squares<a class="headerlink" href="#the-sums-of-squares" title="Permalink to this headline">#</a></h3>
<p>It is important that we fully understand the meaning of the <em>sums of squares</em> in the ANOVA table.</p>
<p>For this, we will fit an additional linear model, the <strong>The Null Model</strong>: <span class="math notranslate nohighlight">\(y = \beta_1\)</span>. This is the simplest linear model appropriate for these data, and says that nothing is going on; the response variable is just has variation around the mean, which cannot be explained by the predictor variable.</p>
<p>The null model is written as an R formula as <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">~</span> <span class="pre">1</span></code>. The code below fits this null model:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">nullModelDragon</span> <span class="o">&lt;-</span> <span class="nf">lm</span><span class="p">(</span><span class="n">logBW</span> <span class="o">~</span> <span class="m">1</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">genome</span><span class="p">,</span> <span class="n">subset</span> <span class="o">=</span> <span class="n">Suborder</span> <span class="o">==</span>  <span class="s">&quot;Anisoptera&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can get the sums of the squares of these residuals from the two models using the function <code class="docutils literal notranslate"><span class="pre">resid</span></code>, and then square them and add them up:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">sum</span><span class="p">(</span><span class="nf">resid</span><span class="p">(</span><span class="n">nullModelDragon</span><span class="p">)</span> <span class="o">^</span> <span class="m">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">36.6710706430075</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">sum</span><span class="p">(</span><span class="nf">resid</span><span class="p">(</span><span class="n">genomeSizeModelDragon</span><span class="p">)</span> <span class="o">^</span> <span class="m">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">28.141680896258</div></div>
</div>
<p>Using the two values from above, the sum of squared residuals for the null model is 36.67. In the genome size model, the sum of squared residuals is 28.14, and so, <span class="math notranslate nohighlight">\(36.67-28.14=8.53\)</span> units of variance have been explained by this model. This is the value in the ANOVA table above.</p>
<hr class="docutils" />
<figure class="align-default" id="regress-null-model">
<a class="reference internal image-reference" href="../_images/regResid.png"><img alt="ANOVA example" src="../_images/regResid.png" style="width: 400px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 29 </span><span class="caption-text"><strong>Comparison of the null and regression models, and the meaning of the sums of squares.</strong> We are interested in how much smaller the residuals are for the genome size model than the null model. Graphically, this means how much shorter are the red residuals than the blue residuals (in the null model).</span><a class="headerlink" href="#regress-null-model" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<hr class="docutils" />
<section id="exercise">
<h3>Exercise<a class="headerlink" href="#exercise" title="Permalink to this headline">#</a></h3>
<p>Using the above code as a template, create a new model called <code class="docutils literal notranslate"><span class="pre">genomeSizeModelDamsel</span></code> that fits log body weight as a function of log genome size for damselflies. Write and run code to get the <code class="docutils literal notranslate"><span class="pre">summary</span></code> and <code class="docutils literal notranslate"><span class="pre">anova</span></code> tables for this new model. For example, the first step would be:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">genomeSizeModelDamsel</span> <span class="o">&lt;-</span> <span class="nf">lm</span><span class="p">(</span><span class="n">logBW</span> <span class="o">~</span> <span class="n">logGS</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">genome</span><span class="p">,</span><span class="n">subset</span><span class="o">=</span><span class="n">Suborder</span><span class="o">==</span><span class="s">&#39;Zygoptera&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="plotting-the-fitted-regression-model">
<h3>Plotting the fitted Regression model<a class="headerlink" href="#plotting-the-fitted-regression-model" title="Permalink to this headline">#</a></h3>
<p>Now we can plot the data and add lines to show the models. For simple regression models, we can use the function <code class="docutils literal notranslate"><span class="pre">abline(modelName)</span></code> to add a line based on the model.</p>
<p>★ You already know how to create and customise scatterplots from previous chapters. Create a plot of log body weight as a function of log genome size, picking your favourite colours for the points.</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">abline</span></code> to add a line for each model and use the <code class="docutils literal notranslate"> <span class="pre">col</span></code> option in the function to colour each line to match the points.</p>
<p>For example: <code class="docutils literal notranslate"><span class="pre">abline(genomeSizeModelDragon,</span> <span class="pre">col='red')</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">myCol</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;red&#39;</span><span class="p">,</span><span class="s">&#39;blue&#39;</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">repr</span><span class="p">);</span> <span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.res</span> <span class="o">=</span> <span class="m">100</span><span class="p">,</span> <span class="n">repr.plot.width</span> <span class="o">=</span> <span class="m">8</span><span class="p">,</span> <span class="n">repr.plot.height</span> <span class="o">=</span> <span class="m">8</span><span class="p">)</span> <span class="c1"># change plot size</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">logBW</span> <span class="o">~</span> <span class="n">logGS</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">genome</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">myCol</span><span class="p">[</span><span class="n">Suborder</span><span class="p">],</span> <span class="n">xlab</span><span class="o">=</span><span class="s">&#39;log Genome Size (pg)&#39;</span><span class="p">,</span> <span class="n">ylab</span><span class="o">=</span><span class="s">&#39;log Body Weight (g)&#39;</span><span class="p">)</span>

<span class="nf">abline</span><span class="p">(</span><span class="n">genomeSizeModelDragon</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14-regress_54_0.png" src="../_images/14-regress_54_0.png" />
</div>
</div>
<p>Your final figure should look something like this:</p>
<hr class="docutils" />
<figure class="align-default" id="dragonfly-regression">
<a class="reference internal image-reference" href="../_images/GenoRegModels.svg"><img alt="ANOVA example" src="../_images/GenoRegModels.svg" width="400px" /></a>
<figcaption>
<p><span class="caption-number">Fig. 30 </span><span class="caption-text"><strong>Linear regression models fitted to the body weight vs. genome size to the Dragonfly (red) and Damselfly (blue) subsets of the data.</strong></span><a class="headerlink" href="#dragonfly-regression" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<hr class="docutils" />
</section>
</section>
<section id="model-diagnostics">
<span id="regress-diagnostics"></span><h2>Model diagnostics<a class="headerlink" href="#model-diagnostics" title="Permalink to this headline">#</a></h2>
<p>Now that we have our models, we need to check that they are appropriate for the data. For this, we will inspect “diagnostic plots”. Producing diagnostic plots is easy in R — if you <code class="docutils literal notranslate"><span class="pre">plot</span></code> the model object, then R produces a set of diagnostic plots!</p>
<p>★ Try the following code (and include in the R script file):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span> <span class="n">mar</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">1.5</span><span class="p">,</span> <span class="m">1.5</span><span class="p">))</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">genomeSizeModelDragon</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14-regress_56_0.png" src="../_images/14-regress_56_0.png" />
</div>
</div>
<p>These are the diagnostics for the <code class="docutils literal notranslate"><span class="pre">lm</span></code> fit to the Dragonfly data subset.</p>
<p>Let’s also plot the diagnostic pots for the model fitted to the Damselfly subset:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span> <span class="n">mar</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">1.5</span><span class="p">,</span> <span class="m">1.5</span><span class="p">))</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">genomeSizeModelDamsel</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14-regress_58_0.png" src="../_images/14-regress_58_0.png" />
</div>
</div>
<p>The diagnostic plots are:</p>
<ul class="simple">
<li><p><strong>Residuals vs Fitted</strong>: This plot is used to spot if the distribution of the residuals (the vertical distance from a point to the regression line) has <em>similar variance</em> for different predicted values (the y-value on the line corresponding to each x-value). There should be no obvious patterns (such as curves) or big gaps. If there was no scatter, if all the points fell exactly on the line, then all of the dots on this plot would lie on the gray horizontal dashed line. The red line is a smoothed curve to make it easier to see trends in the residuals. It is flat in the Dragonfly model fit above, and a bit more wavy than we would like in the in the Damselfly model fit, but there are no clear trends in either, which is what you hope to see.</p></li>
<li><p><strong>Normal Q–Q</strong>: This plot is to check whether the residuals are <em>normally distributed</em> — are the values of the observed residuals similar to those expected under a normal distribution? Ideally, the points should form a perfectly straight line, indicating that the observed residuals exactly match the expected. Here, note that the points lie pretty close to the dashed line in both sets of diagnostic Figures above, but deviate at the ends, especially for Damselflies. However, some deviation is to be expected near the ends — here these deviations are just about acceptable.</p></li>
<li><p><strong>Scale–Location</strong>: The x-axis on this plot is identical to the Residuals vs Fitted plot – these are the fitted values. The y-axis is the square root of the <em>standardized residuals</em>, which are residuals rescaled so that they have a mean of zero and a variance of one. As a result, all y-axis values are positive. Thus large residuals (both positive and negative) plot at the top, and small residuals plot at the bottom (so only their <em>scale</em> is retained). Thus, all of the numbered points (which will be the same in all plots) plot at the top here. The red line here shows the trend, just like the Residuals vs Fitted plot. The regression analysis has assumed homoscedasticity, that the variance in the residuals doesn’t change as a function of the predictor. If that assumption is correct, the red line should be relatively flat. It is not quite as flat as we would like, especially for the Dragonfly analysis.</p></li>
<li><p><strong>Residuals vs Leverage</strong>: This plot shows the standardized residuals against leverage. “Leverage” is a measure of how much each data point influences the linear model’s coefficient estimates. Because the regression line must pass through the centroid (“pivot point”) of the data, points that lie far from the centroid have greater leverage, and their leverage increases if there are fewer points nearby. Here is an illustration:</p></li>
</ul>
<hr class="docutils" />
<figure class="align-default" id="regress-leverage">
<a class="reference internal image-reference" href="../_images/Leverage.svg"><img alt="Leverage" src="../_images/Leverage.svg" width="250px" /></a>
<figcaption>
<p><span class="caption-number">Fig. 31 </span><span class="caption-text"><strong>Leverage of data points on slope of a regression.</strong> The points further away from the centroid in the x-axis direction have more leverage, and can therefore move the regression line up or down (dashed red lines).</span><a class="headerlink" href="#regress-leverage" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<hr class="docutils" />
<p>There are two key things to note about the above plot:</p>
<ol class="simple">
<li><p>The standardized residuals (y-axis) are centered around zero and reach 2-3 standard deviations away from zero. They should also lie symmetrically about zero, as would be expected for a normal distribution. This is the case for the Damselfly plot , but not so much for the Dragonfly plot.</p></li>
<li><p>The contours values show <em>Cook’s distance</em> (only visible in the Damsefly plot), which measures how much the regression would change if a point was deleted. Cook’s distance is increased by leverage and by large residuals: a point far from the centroid with a large residual can severely distort the coefficient estimates from the regression. On this plot, you want to see that the red smoothed line stays close to the horizontal gray dashed line and that no points have a large Cook’s distance (i.e, &gt;0.5). Both are true here.</p></li>
</ol>
<p>This is an important diagnostic plot in regression analyses in particular because it tells you whether your estimate of the slope coefficient in particular is strongly affected by certain data points.</p>
<p>Note that certain points are numbered in all the diagnostic plots — these are points to pay special attention to because they are <em>potential</em> outliers. The numbers correspond to the row number for that dataset in your data frame. You can easily identify these points in your data plot because the order of the points along the fitted values axis (y-axis) in the diagnostic plot matches the order along the x-axis in the data plot. So, for example here, in the dragonfly diagnostic plots the two numbered points (46, 10) near the bottom correspond in the data plot to the two red points near the center-left that lie farthest below the red line (see the plot with regression lines fitted to the data).</p>
<p>Thus, neither the Drangonfly nor the Damselfly diagnostic plots look perfect, but this level of deviation from assumptions of linear models is acceptable. The main worrying factors are that the Q-Q plot for Damselflies indicates the observed residuals are a bit more extreme than expected, and the Scale–Location plot for Dragonflies suggests some pattern in the standardized residuals wrt location of the fitted values.</p>
<p>★ Copy the code to create the diagnostic plots into your script to keep a
record of the code and run it.</p>
</section>
<section id="reporting-the-model">
<h2>Reporting the model<a class="headerlink" href="#reporting-the-model" title="Permalink to this headline">#</a></h2>
<p>Now we know that the models are appropriate and we have a plot, the last thing is to report the statistics. For the damselfly model, here is one summary that would do: log genome size explains significant variation in log body weight in dameselflies (F=10.5, df=1,36, p=0.0025) and shows that body weight decreases with genome size (intercept: -4.65, se=0.09;
slope: -1.14, se=0.35).</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            kernelName: "ir",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="13-t_F_tests.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Basic hypothesis testing: <span class="math notranslate nohighlight">\(t\)</span> and <span class="math notranslate nohighlight">\(F\)</span> tests</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="15-anova.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Linear Models: Analysis of variance</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Samraat Pawar<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>
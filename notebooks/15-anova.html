

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Linear Models: Analysis of variance &#8212; TheMulQuaBio</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/15-anova';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Linear Models: Multiple explanatory variables" href="16-MulExpl.html" />
    <link rel="prev" title="Linear Models: Regression" href="14-regress.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="TheMulQuaBio - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="TheMulQuaBio - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to The Multilingual Quantitative Biologist!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Computing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01-Unix.html">UNIX and Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="02-ShellScripting.html">Shell scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="03-Git.html">Version control with Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="04-LaTeX.html">Scientific documents with <span class="math notranslate nohighlight">\(\LaTeX\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="05-Python_I.html">Biological Computing in Python I</a></li>
<li class="toctree-l1"><a class="reference internal" href="07-R.html">Biological Computing in R</a></li>
<li class="toctree-l1"><a class="reference internal" href="06-Python_II.html">Biological Computing in Python II</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Maths for Biologists</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../mathscourse/lecture01/01_Making_mathematical_statements.html">01 - Making mathematical statements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mathscourse/lecture02/02_Describing_shapes_and_patterns.html">02   - Describing shapes and patterns</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mathscourse/lecture03/03_Analysing_change%2C_one_step_at_a_time.html">03   - Analysing change, one step at a time</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mathscourse/lecture04/04_From_table_arrangements_to_powerful_tools.html">04 - From table arrangements to powerful tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mathscourse/lecture05/05_From_table_arrangements_to_powerful_tools_part2.html">05 - From table arrangements to powerful tools - part 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mathscourse/lecture06/06_Analysing_change_continuously.html">06 - Analysing change, continuously</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mathscourse/lecture07/07_Analysing_change_continuously_part2.html">07 - Analysing change, continuously (Part 2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mathscourse/lecture08/08_Calculating_accumulated_change.html">08 - Calculating accumulated change</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mathscourse/tutorials/lecture01/Tutorial_01.html">Tutorial 01</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mathscourse/tutorials/lecture05/Tutorial_05.html">Tutorial 05</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mathscourse/tutorials/lecture06/Tutorial_06.html">Tutorial 06</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Basic Data Analyses and Statistics</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Stats-Intro.html">Introduction to this section</a></li>
<li class="toctree-l1"><a class="reference internal" href="08-Data_R.html">Data Management and Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="12-ExpDesign.html">Experimental design and Data exploration</a></li>
<li class="toctree-l1"><a class="reference internal" href="13-t_F_tests.html">Basic hypothesis testing: <span class="math notranslate nohighlight">\(t\)</span> and <span class="math notranslate nohighlight">\(F\)</span> tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="14-regress.html">Linear Models: Regression</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Linear Models: Analysis of variance</a></li>
<li class="toctree-l1"><a class="reference internal" href="16-MulExpl.html">Linear Models: Multiple explanatory variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="17-MulExplInter.html">Linear Models: Multiple variables with interactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="18-ModelSimp.html">Model simplification</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Advanced Data Analyses and Statistics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="19-glm.html">Generalised Linear Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="20-ModelFitting-NLLS.html">Model Fitting using Non-linear Least-squares</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Appendix-JupyIntro.html">Introduction to Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="Appendix-Data-Python.html">Data analyses  with Python &amp; Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="Appendix-Maths.html">Mathematical models in Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="Appendix-Databases.html">Databases <span class="tocSkip"></span></a></li>
<li class="toctree-l1"><a class="reference internal" href="Appendix-NLLS-Python.html">Model fitting in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="Appendix-MiniProj.html">The Computing Miniproject</a></li>
<li class="toctree-l1"><a class="reference internal" href="Appendix-Assessment.html">Coursework Assessment</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/mhasoba/TheMulQuaBio" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/mhasoba/TheMulQuaBio/issues/new?title=Issue%20on%20page%20%2Fnotebooks/15-anova.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/15-anova.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Linear Models: Analysis of variance</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-anova">What is ANOVA?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-the-anova-test-statistic">Calculating the ANOVA test statistic</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#degrees-of-freedom">Degrees of freedom</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-f-value-or-ratio">The F-Value (or Ratio)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-r-2">The R<span class="math notranslate nohighlight">\(^2\)</span></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#adjusted-r-2">Adjusted R<span class="math notranslate nohighlight">\(^2\)</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#an-example-anova">An example ANOVA</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-data">The data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exploring-the-data-with-boxplots">Exploring the data with boxplots</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#differences-in-means-with-barplots">Differences in means with barplots</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#an-alternative-to-barplots">An alternative to barplots</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-of-variance">Analysis of variance</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-criticism">Model criticism</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-pairwise-differences-between-levels">Testing pairwise differences between levels</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#are-the-factors-independent">Are the factors independent?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-chi-square-test-and-count-data">The Chi-square test and count data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-chi-square-test-with-the-mammals-data">The Chi-square test with the mammals data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#saving-data">Saving data</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="linear-models-analysis-of-variance">
<h1>Linear Models: Analysis of variance<a class="headerlink" href="#linear-models-analysis-of-variance" title="Permalink to this heading">#</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">#</a></h2>
<p>Analysis of Variance, is very often a good choice if your response (dependent) variable is continuous, and your  predictor (independent) variables is categorical.</p>
<p>In this chapter, you will learn to perform an ANOVA, that is, fit this linear model to the data. Specifically, you will learn to<span class="xref myst"><span class="math notranslate nohighlight">\(^{[1]}\)</span></span>:</p>
<ul class="simple">
<li><p>Visualize the data by plotting boxplots and barplots</p></li>
<li><p>Fit an ANOVA to test whether certain factors can explain (partition) the variation in your data</p></li>
<li><p>Perform diagnostics to determine whether the factors are explanatory, and whether the Linear Model is appropriate for your data</p></li>
<li><p>Explore and compare how much the different levels of a factor explain the variation in your data</p></li>
</ul>
</section>
<section id="what-is-anova">
<h2>What is ANOVA?<a class="headerlink" href="#what-is-anova" title="Permalink to this heading">#</a></h2>
<p><u>An</u>alysis  <u>O</u>f  <u>Va</u>riance (ANOVA) is an extremely useful class of Linear models. It is very often appropriate when your response (dependent) variable is continuous, while your predictor (independent) variable is categorical. Specifically, <em>One-way ANOVA</em> is used to compare means of two or more samples representing numerical, continuous data in response to a single categorical variable (factor).</p>
<hr class="docutils" />
<figure class="align-default" id="id1">
<a class="reference internal image-reference" href="../_images/ANOVA_is_LM.svg"><img alt="ANOVA example" src="../_images/ANOVA_is_LM.svg" width="300px" /></a>
<figcaption>
<p><span class="caption-number">Fig. 32 </span><span class="caption-text"><strong>A dataset where an ANOVA is appropriate.</strong> Performing an ANOVA on this dataset is the same as fitting the linear model <span class="math notranslate nohighlight">\(y  = \beta_1  + \beta_2 x_s + \beta_3 x_a\)</span>, where <span class="math notranslate nohighlight">\(x_s\)</span> and <span class="math notranslate nohighlight">\(x_a\)</span> are two levels (“treatments”, representing statistically separate populations) within the factor (games console ownership). Here, the first treatment, the control, is captured by the baseline value <span class="math notranslate nohighlight">\(\beta_1\)</span> (the sample with the lowest value, on the far left).</span><a class="headerlink" href="#id1" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<hr class="docutils" />
<p>(One-way) ANOVA tests the null hypothesis that samples from two or more groups (the treatments or factors) are drawn from populations with the <em>same mean value</em>. That is, the null hypothesis is that all the groups are random samples from the <em>same</em> population (no statistical difference in their means). To do this, ANOVA compares the variance in the data explained by fitting the linear model, to the unexplained variance (the null hypothesis.</p>
<p>In other words, in effect, ANOVA asks whether a linear model with a predictor (or explanatory variable) with at least two categorical levels (or factors), better accounts for the variance (Explained Sum of Squares, ESS, see below) than a null model of the form <span class="math notranslate nohighlight">\(y  = \beta_1\)</span> (<a class="reference internal" href="#id1"><span class="std std-ref">Figure 1</span></a>). Thus, ANOVA is just a type of linear model.</p>
<p>By the end of this chapter, it will also make more sense to you how/why fitting a linear regression model to the data that we learned <a class="reference internal" href="14-regress.html"><span class="doc std std-doc">previously</span></a>, of the form <span class="math notranslate nohighlight">\(y = \beta_1  + \beta_2 x\)</span> (where <span class="math notranslate nohighlight">\(x\)</span> is a continuous predictor variable), requires an ANOVA to determine if the model better fits than a null model of the form <span class="math notranslate nohighlight">\(y  = \beta_1\)</span>.</p>
<p>Typically, one-way ANOVA is used to test for differences among at least three groups, since the two-group (or levels or factors) case can be covered by a <span class="math notranslate nohighlight">\(t\)</span>-test (see <a class="reference internal" href="13-t_F_tests.html"><span class="doc std std-doc">t &amp; F tests</span></a>). When there are only two means to compare, the <span class="math notranslate nohighlight">\(t\)</span>-test and the F-test are equivalent; the relation between ANOVA and t is given by <span class="math notranslate nohighlight">\(F = t^2\)</span>.</p>
<p>An extension of one-way ANOVA is two-way analysis of variance that examines the influence of two different categorical independent variables on one dependent variable — we will look at multiple predictor variables in the <a class="reference internal" href="16-MulExpl.html"><span class="doc std std-doc">Multiple Explanatory Variables Chapter</span></a> onwards.</p>
</section>
<section id="calculating-the-anova-test-statistic">
<span id="anova-sos"></span><h2>Calculating the ANOVA test statistic<a class="headerlink" href="#calculating-the-anova-test-statistic" title="Permalink to this heading">#</a></h2>
<p>ANOVA uses of the <a class="reference internal" href="13-t_F_tests.html"><span class="doc std std-doc">F-Statistic</span></a>. To this end, an ANOVA “partitions” variability in your data as follows:</p>
<p><strong>Total sum of squares (TSS)</strong>: This is the sum of the squared difference between the observed dependent variable values (the <span class="math notranslate nohighlight">\(y\)</span>’s) and the mean of the response variable (denoted by <span class="math notranslate nohighlight">\(\bar{y}\)</span>), i.e.,</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
    \text{TSS} = \sum_{i=1}^{n}(y_i - \bar{y})^2
\end{equation*}\]</div>
<p>TSS tells us how much variation there is in the dependent variable without having any other information (your null model). You might notice that TSS is the numerator of the <em>sample variance</em> (or it’s square-root, the <em>sample standard deviation</em>), which you learned about <a class="reference internal" href="12-ExpDesign.html#expdesign-descriptive-stats"><span class="std std-ref">previously</span></a>.</p>
<p><strong>Explained sum of squares (ESS)</strong>: Sum of the squared differences between the predicted <span class="math notranslate nohighlight">\(y\)</span>’s (denoted by <span class="math notranslate nohighlight">\(\hat{y}\)</span>’s) and <span class="math notranslate nohighlight">\(\bar{y}\)</span>, or,</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
    \text{ESS} = \sum_{i=1}^{n} (\hat{y}_i - \bar{y})^2
\end{equation*}\]</div>
<p>ESS tells us how much of the variation in the dependent variable our alternative (linear) model was able to explain by measuring variation in the <em>modelled</em> <span class="math notranslate nohighlight">\(y\)</span> values (the <span class="math notranslate nohighlight">\(\hat{y}\)</span>’s). In othjer words, it measures the reduction in uncertainty that occurs when the linear model is used to predict the responses.</p>
<p><strong>Residual sum of squares (RSS)</strong>: Sum of the squared differences between the observed <span class="math notranslate nohighlight">\(y\)</span>’s (denoted by <span class="math notranslate nohighlight">\(y_i\)</span> for the <span class="math notranslate nohighlight">\(i^{th}\)</span> observation) and the predicted <span class="math notranslate nohighlight">\(\hat{y}\)</span>, or,</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
    \text{RSS} = \sum_{i=1}^{n} (\hat{y}_i - y_i)^2
\end{equation*}\]</div>
<p>RSS tells us how much of the variation in the dependent variable our model could not explain. That is, it’s the uncertainty that remains even after the linear model is used. The linear model is considered to be statistically significant if it can account for a large amount of variability in the response.</p>
<ul class="simple">
<li><p>And of course, TSS = ESS + RSS. That is, the OLS method “decomposes” the total variation in the dependent variable into an explained component (ESS; explained by the predictor) and an unexplained or residual component (the RSS).</p></li>
</ul>
<p>The sums of squares used to calculate the statistical significance of the linear model (Regression, ANOVA, etc) through the F value are as follows:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Type of Sum of Squares (SS)</p></th>
<th class="head text-center"><p>SS Calculation</p></th>
<th class="head text-center"><p>Degrees of Freedom (DF)</p></th>
<th class="head text-center"><p>Mean Sum of Squares (MSS)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>TSS</p></td>
<td class="text-center"><p><span class="math notranslate nohighlight">\(\sum_{i=1}^{n}(y_i - \bar{y})^2\)</span></p></td>
<td class="text-center"><p><span class="math notranslate nohighlight">\(n-1\)</span></p></td>
<td class="text-center"><p><span class="math notranslate nohighlight">\(\frac{TSS}{n-1}\)</span></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>ESS</p></td>
<td class="text-center"><p><span class="math notranslate nohighlight">\(\sum_{i=1}^{n} (\hat{y}_i - \bar{y})^2\)</span></p></td>
<td class="text-center"><p><span class="math notranslate nohighlight">\(n_c-1\)</span></p></td>
<td class="text-center"><p><span class="math notranslate nohighlight">\(\frac{ESS}{n_c-1}\)</span></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>RSS</p></td>
<td class="text-center"><p><span class="math notranslate nohighlight">\(\sum_{i=1}^{n} (\hat{y}_i - y_i)^2\)</span></p></td>
<td class="text-center"><p><span class="math notranslate nohighlight">\(n-n_c\)</span></p></td>
<td class="text-center"><p><span class="math notranslate nohighlight">\(\frac{RSS}{n-n_c}\)</span></p></td>
</tr>
</tbody>
</table>
<p>Let’s try to make sense of these calculations. Firstly, because we are dealing with samples understanding the degrees of freedom is critical.</p>
<section id="degrees-of-freedom">
<h3>Degrees of freedom<a class="headerlink" href="#degrees-of-freedom" title="Permalink to this heading">#</a></h3>
<p>Each sum of squares has a corresponding degrees of freedom (DF) associated with it that gives the Mean Sum of Squares (MSS) — the Sums of Squares divided by the corresponding degrees of freedom.</p>
<ul class="simple">
<li><p>The TSS DF is one less than the number of observations <span class="math notranslate nohighlight">\(n-1\)</span>. This is because calculating TSS, needs <span class="math notranslate nohighlight">\(\bar y\)</span> , which imposes loss of one degree of freedom. Note that MSS is thus nothing but the sample variance.</p></li>
<li><p>The ESS DF is one less than the number of coefficients (<span class="math notranslate nohighlight">\(n_c\)</span>) (estimated parameters) in the model: <span class="math notranslate nohighlight">\(n_c-1\)</span>. Note that in the case where the linear model is an ANOVA, the number of coefficients equals the number of “treatments” (the categories or levels in the predictor or factor). So for example, in <a class="reference internal" href="#id1"><span class="std std-ref">Figure 1</span></a>, there are three treatments (predictors) and therefore three coefficients (<span class="math notranslate nohighlight">\(\beta_1\)</span>, <span class="math notranslate nohighlight">\(\beta_2\)</span>, <span class="math notranslate nohighlight">\(\beta_3\)</span>), which means that the ESS degrees of freedom there is <span class="math notranslate nohighlight">\(n_c-1 = 2\)</span>.</p></li>
<li><p>The RSS DF is the sample size <span class="math notranslate nohighlight">\(n\)</span> minus the number of coefficients that you need to estimate (<span class="math notranslate nohighlight">\(n_c\)</span>), that is, <span class="math notranslate nohighlight">\(n - n_c\)</span>, because each estimated coefficient is an unknown parameter.</p></li>
</ul>
</section>
<section id="the-f-value-or-ratio">
<h3>The F-Value (or Ratio)<a class="headerlink" href="#the-f-value-or-ratio" title="Permalink to this heading">#</a></h3>
<p>The F-Value or F-Ratio, the test statistic used to decide whether the linear model fit is statistically significant, is the ratio of the Mean ESS to the Mean RSS:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
F = \frac{\left(\frac{ESS}{n_c-1}\right)}{\left(\frac{RSS}{n-n_c}\right)}
\end{equation*}\]</div>
<p>If the null hypothesis that the group means are drawn from sub-populations with the <em>same</em> mean were indeed true, the between-group variance (numerator in this F-ratio) should be lower than the within-group variance (denominator). The null hypothesis is rejected if this F-Ratio is large — the model explains a significant amount of variance, and we can conclude that the samples were drawn from populations with different mean values.</p>
<p>The p-value is calculated for the overall model fit using the F-distribution as you learned before, in <a class="reference internal" href="13-t_F_tests.html"><span class="doc std std-doc">t &amp; F tests</span></a>.</p>
<p>Also note that the Root Mean Square Error (RMSE), also known as the standard error of the estimate, is the square root of the Mean RSS. It is the standard deviation of the data about the Linear model, rather than about the sample mean.</p>
</section>
<section id="the-r-2">
<h3>The R<span class="math notranslate nohighlight">\(^2\)</span><a class="headerlink" href="#the-r-2" title="Permalink to this heading">#</a></h3>
<p>The R<span class="math notranslate nohighlight">\(^2\)</span>, also called the Coefficient of Determination, is the proportion of total error (TSS) explained by the model (ESS), so the ratio ESS/TSS. That is it is the proportion of the variability in the response that is explained by the fitted model. Since TSS = ESS + RSS, R<span class="math notranslate nohighlight">\(^2\)</span> can be rewritten as (TSS-RSS)/TSS = 1 - RSS/TSS. If a model has perfectly fits the data, <span class="math notranslate nohighlight">\(R^{2}=1\)</span>, and if it has no predictive capability <span class="math notranslate nohighlight">\(R^{2}=0\)</span>. In reality, R<span class="math notranslate nohighlight">\(^2\)</span> will never be exactly 0 because even a null model will explain some variance just by chance due to sampling error. Note that <span class="math notranslate nohighlight">\(R\)</span>, the square root of R<span class="math notranslate nohighlight">\(^2\)</span>, is the multiple correlation coefficient: the correlation between the observed values (<span class="math notranslate nohighlight">\(y\)</span>), and the predicted values (<span class="math notranslate nohighlight">\(\hat{y}\)</span>).</p>
<section id="adjusted-r-2">
<h4>Adjusted R<span class="math notranslate nohighlight">\(^2\)</span><a class="headerlink" href="#adjusted-r-2" title="Permalink to this heading">#</a></h4>
<p>As additional predictors (and therefore linear model coefficients) are added to a linear model, R<span class="math notranslate nohighlight">\(^2\)</span> increases even when the new predictors add no real predictive capability. The adjusted-R<span class="math notranslate nohighlight">\(^2\)</span> tries to address this problem of over-specification or over-fitting by including the degrees of freedom: Adjusted R<span class="math notranslate nohighlight">\(^2\)</span> = 1 - (RSS/<span class="math notranslate nohighlight">\(n-n_c-2\)</span>)/(TSS/<span class="math notranslate nohighlight">\(n-1\)</span>) <span class="xref myst"><span class="math notranslate nohighlight">\(^{[2]}\)</span></span>.</p>
<p>Thus, additional predictors with little explanatory capability will increase the ESS (and reduce the RSS), but they will also have lower RSS degrees of freedom (because of the additional number of fitted coefficients, <span class="math notranslate nohighlight">\(n_c\)</span>’s)<span class="xref myst"><span class="math notranslate nohighlight">\(^{[3]}\)</span></span>. Thus if the additional predictors have poor predictive capability, these two reductions will cancel each other out. In other words, the Adjusted R<span class="math notranslate nohighlight">\(^2\)</span> penalizes the addition of new predictors to the linear model, so you should always have a look at the Adjusted R<span class="math notranslate nohighlight">\(^2\)</span> as a corrected measure of R<span class="math notranslate nohighlight">\(^2\)</span>.</p>
</section>
</section>
</section>
<section id="an-example-anova">
<h2>An example ANOVA<a class="headerlink" href="#an-example-anova" title="Permalink to this heading">#</a></h2>
<p>In this Chapter, we will use a new dataset of genome size and life history in mammals to try out a one-way ANOVA.</p>
<section id="the-data">
<h3>The data<a class="headerlink" href="#the-data" title="Permalink to this heading">#</a></h3>
<p>These data are taken from an online database of genome sizes and a <a class="reference external" href="http://www.genomesize.com/">published database of mammalian life history</a>.</p>
<p>Trait data for these species are taken from: <a class="reference external" href="http://esapubs.org/archive/ecol/e090/184/metadata.htm"> Jones, K. E. <em>et al.</em> (2009) PanTHERIA: a species-level database of life history, ecology, and geography of extant and recently extinct mammals. Ecology 90, 2648–2648</a>.</p>
<p><span class="math notranslate nohighlight">\(\star\)</span> Download the file <a class="reference external" href="https://raw.githubusercontent.com/mhasoba/TheMulQuaBio/master/content/data/MammalData.csv"><code class="docutils literal notranslate"><span class="pre">MammalData.csv</span></code></a> from the github repository and save to your <code class="docutils literal notranslate"><span class="pre">Data</span></code> directory (Right-click and “Save as”…).</p>
<p><span class="math notranslate nohighlight">\(\star\)</span> Create a new blank script called <code class="docutils literal notranslate"><span class="pre">ANOVA_Prac.R</span></code> and add some introductory comments.</p>
<p><span class="math notranslate nohighlight">\(\star\)</span> Use <code class="docutils literal notranslate"><span class="pre">read.csv</span></code> to load the data in the data frame <code class="docutils literal notranslate"><span class="pre">mammals</span></code> and then <code class="docutils literal notranslate"><span class="pre">str</span></code> and <code class="docutils literal notranslate"><span class="pre">summary</span></code> to examine the data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">mammals</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">read.csv</span><span class="p">(</span><span class="s">&#39;../data/MammalData.csv&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">T</span><span class="p">)</span>
<span class="nf">str</span><span class="p">(</span><span class="n">mammals</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;data.frame&#39;:	379 obs. of  9 variables:
 $ Binomial       : Factor w/ 379 levels &quot;Acinonyx jubatus&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
 $ meanCvalue     : num  2.56 2.64 3.75 3.7 3.98 4.69 2.15 2.43 2.73 2.92 ...
 $ Order          : Factor w/ 21 levels &quot;Artiodactyla&quot;,..: 2 17 17 17 1 1 4 17 17 17 ...
 $ AdultBodyMass_g: num  50500 41.2 130 96.5 94700 52300 15 25.3 50.5 33 ...
 $ DietBreadth    : int  1 NA 2 NA 5 2 NA 4 NA NA ...
 $ HabitatBreadth : int  1 NA 2 2 1 1 1 2 NA 1 ...
 $ LitterSize     : num  2.99 2.43 3.07 NA 1 1 0.99 4.59 3.9 3.77 ...
 $ GroundDwelling : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 2 NA 2 2 2 2 1 2 NA 2 ...
 $ TrophicLevel   : Factor w/ 3 levels &quot;Carnivore&quot;,&quot;Herbivore&quot;,..: 1 NA 2 NA 2 2 NA 3 NA NA ...
</pre></div>
</div>
</div>
</div>
<p>There are nine variables. The first two are the latin binomial and taxonomic order of each species, followed by the species mean genome size (‘C value’, picograms), adult body mass (g), diet breadth, habitat breadth, litter size and then two factors showing whether the species are ground dwelling and their trophic level. For more information, see the link to the data above. Let’s summarize the data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">summary</span><span class="p">(</span><span class="n">mammals</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                Binomial     meanCvalue             Order     AdultBodyMass_g  
 Acinonyx jubatus   :  1   Min.   :1.863   Rodentia    :120   Min.   :      5  
 Acomys cahirinus   :  1   1st Qu.:2.768   Chiroptera  : 80   1st Qu.:     37  
 Aconaemys fuscus   :  1   Median :3.250   Primates    : 63   Median :    286  
 Aconaemys sagei    :  1   Mean   :3.352   Artiodactyla: 22   Mean   :  51787  
 Addax nasomaculatus:  1   3rd Qu.:3.798   Carnivora   : 18   3rd Qu.:   5620  
 Aepyceros melampus :  1   Max.   :8.400   Xenarthra   : 15   Max.   :3940000  
 (Other)            :373                   (Other)     : 61   NA&#39;s   :13       
  DietBreadth    HabitatBreadth    LitterSize     GroundDwelling
 Min.   :1.000   Min.   :1.000   Min.   : 0.900   No  :159      
 1st Qu.:1.000   1st Qu.:1.000   1st Qu.: 1.000   Yes :135      
 Median :3.000   Median :1.000   Median : 1.170   NA&#39;s: 85      
 Mean   :2.752   Mean   :1.445   Mean   : 2.543                 
 3rd Qu.:4.000   3rd Qu.:2.000   3rd Qu.: 3.705                 
 Max.   :8.000   Max.   :3.000   Max.   :12.000                 
 NA&#39;s   :76      NA&#39;s   :80      NA&#39;s   :44                     
    TrophicLevel
 Carnivore: 51  
 Herbivore:129  
 Omnivore :123  
 NA&#39;s     : 76  
                
                
                
</pre></div>
</div>
</div>
</div>
<p>You will see from the output of <code class="docutils literal notranslate"><span class="pre">summary</span></code> that there is lots of missing data for the life history traits.</p>
</section>
<section id="exploring-the-data-with-boxplots">
<h3>Exploring the data with boxplots<a class="headerlink" href="#exploring-the-data-with-boxplots" title="Permalink to this heading">#</a></h3>
<p>We are interested in finding out whether the mean C value for species varies predictably for different levels of life history traits (a typical one-way ANOVA question). For example:</p>
<ul class="simple">
<li><p>Do carnivores or herbivores have larger genome sizes?</p></li>
<li><p>Do ground dwelling mammals have larger or smaller genome sizes?</p></li>
<li><p>Before we fit any models, we want to plot the data to see if the means within these groupings look different. We also want to check whether the variance looks similar for each group: <em>constant normal variance</em>! A simple way is to look at box and whisker plots, showing the median and range of the data:</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(\star\)</span> Generate a boxplot of the differences in genome sizes between trophic levels:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">plot</span><span class="p">(</span><span class="n">meanCvalue</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">TrophicLevel</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mammals</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/a50f5c623e2ca8d3592482018480b9f6731c5df7d61e4020c96aa8692beabf56.png" src="../_images/a50f5c623e2ca8d3592482018480b9f6731c5df7d61e4020c96aa8692beabf56.png" />
</div>
</div>
<p>Looking at the plots, it is clear that there is more spread in the data above the median than below. Create a new variable <code class="docutils literal notranslate"><span class="pre">logCvalue</span></code> in the <code class="docutils literal notranslate"><span class="pre">mammals</span></code> data frame containing logged C values.</p>
<p><span class="math notranslate nohighlight">\(\star\)</span> Now create a boxplot of log C values within trophic groups:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">mammals</span><span class="o">$</span><span class="n">logCvalue</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">mammals</span><span class="o">$</span><span class="n">meanCvalue</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><span class="math notranslate nohighlight">\(\star\)</span> Repeat the two plot commands to look at differences between ground dwelling and other species.</p>
</section>
<section id="differences-in-means-with-barplots">
<h3>Differences in means with barplots<a class="headerlink" href="#differences-in-means-with-barplots" title="Permalink to this heading">#</a></h3>
<p>Box and whisker plots show the median and spread in the data very clearly, but we want to test whether the means are different. This is <span class="math notranslate nohighlight">\(t\)</span> test territory — how different are the means given the standard error — so it is common to use barplots and standard error bars to show these differences.</p>
<p>We’re going to use some R code to construct a barplot by hand. We need to calculate the means and standard errors within trophic groups, but before we can do that, we need a new functions to calculate the standard error of a mean:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">seMean</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span><span class="w"> </span><span class="c1"># get standard error of the mean from a set of values (x)</span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">na.omit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="c1"># get rid of missing values</span>

<span class="w">    </span><span class="n">se</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="nf">var</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="c1"># calculate the standard error</span>

<span class="w">    </span><span class="nf">return</span><span class="p">(</span><span class="n">se</span><span class="p">)</span><span class="w">  </span><span class="c1"># tell the function to return the standard error</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can use the function <code class="docutils literal notranslate"><span class="pre">tapply</span></code>: it splits a variable up into groups from a factor and calculates statistics on each group using a function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">trophMeans</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">tapply</span><span class="p">(</span><span class="n">mammals</span><span class="o">$</span><span class="n">logCvalue</span><span class="p">,</span><span class="w"> </span><span class="n">mammals</span><span class="o">$</span><span class="n">TrophicLevel</span><span class="p">,</span><span class="w"> </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="n">trophMeans</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Carnivore Herbivore  Omnivore 
 1.085067  1.196928  1.236347 
</pre></div>
</div>
</div>
</div>
<p>And similarly, let’s calculate the standard error of the mean using the function we made:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">trophSE</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">tapply</span><span class="p">(</span><span class="n">mammals</span><span class="o">$</span><span class="n">logCvalue</span><span class="p">,</span><span class="w"> </span><span class="n">mammals</span><span class="o">$</span><span class="n">TrophicLevel</span><span class="p">,</span><span class="w"> </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seMean</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="n">trophSE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Carnivore  Herbivore   Omnivore 
0.03982602 0.02205630 0.01843627 
</pre></div>
</div>
</div>
</div>
<p>Now we have to put these values together on the plot.</p>
<p>Let’s first get the upper and lower limits of the error bars:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">upperSE</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">trophMeans</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">trophSE</span>
<span class="n">lowerSE</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">trophMeans</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">trophSE</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">upperSE</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.dl-inline {width: auto; margin:0; padding: 0}
.dl-inline>dt, .dl-inline>dd {float: none; width: auto; display: inline-block}
.dl-inline>dt::after {content: ":\0020"; padding-right: .5ex}
.dl-inline>dt:not(:first-of-type) {padding-left: .5ex}
</style><dl class=dl-inline><dt>Carnivore</dt><dd>1.12489290666848</dd><dt>Herbivore</dt><dd>1.21898454975239</dd><dt>Omnivore</dt><dd>1.25478376489463</dd></dl>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">lowerSE</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.dl-inline {width: auto; margin:0; padding: 0}
.dl-inline>dt, .dl-inline>dd {float: none; width: auto; display: inline-block}
.dl-inline>dt::after {content: ":\0020"; padding-right: .5ex}
.dl-inline>dt:not(:first-of-type) {padding-left: .5ex}
</style><dl class=dl-inline><dt>Carnivore</dt><dd>1.04524087060908</dd><dt>Herbivore</dt><dd>1.17487195482678</dd><dt>Omnivore</dt><dd>1.21791123320182</dd></dl>
</div></div>
</div>
<p>Next, we draw the barplot, and also the error bars with two sequential commands:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">barMids</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">barplot</span><span class="p">(</span><span class="n">trophMeans</span><span class="p">,</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">upperSE</span><span class="p">)),</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;log C value (pg)&#39;</span><span class="p">)</span>
<span class="nf">arrows</span><span class="p">(</span><span class="n">barMids</span><span class="p">,</span><span class="w"> </span><span class="n">upperSE</span><span class="p">,</span><span class="w"> </span><span class="n">barMids</span><span class="p">,</span><span class="w"> </span><span class="n">lowerSE</span><span class="p">,</span><span class="w"> </span><span class="n">ang</span><span class="o">=</span><span class="m">90</span><span class="p">,</span><span class="w"> </span><span class="n">code</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/7bc12784bca891ca182d09f07ecb7a1a6286236dbcc51de76193867236a3f774.png" src="../_images/7bc12784bca891ca182d09f07ecb7a1a6286236dbcc51de76193867236a3f774.png" />
</div>
</div>
<p>In the first command, we plotted the bars and also store information on where the midpoints of the bars on the x-axis are.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">print</span><span class="p">(</span><span class="n">barMids</span><span class="p">)</span><span class="w"> </span><span class="c1"># see what barMids is</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     [,1]
[1,]  0.7
[2,]  1.9
[3,]  3.1
</pre></div>
</div>
</div>
</div>
<p>That is, the <code class="docutils literal notranslate"><span class="pre">barplot</span></code> function no only plots bars, but also returns where the middle of the bars are on the x-axis, which we have stored in <code class="docutils literal notranslate"><span class="pre">barMids</span></code>. These values are numeric even though the x-axis represents a categorical variable because these are <em>locations</em> of the bars’ midpoints in the plot’s x-scale.</p>
<p>Also, we have set the y-axis limits using <code class="docutils literal notranslate"><span class="pre">c(0,</span> <span class="pre">max(upperSE))</span></code> to make sure that the tops of error bars don’t get cut off.</p>
<p>Then, we used the <a class="reference external" href="https://stat.ethz.ch/R-manual/R-devel/library/graphics/html/arrows.html"><code class="docutils literal notranslate"><span class="pre">arrows</span></code> function</a> to add error bars. This function draws arrows between any two pairs of points (coordinates) <code class="docutils literal notranslate"><span class="pre">(x0,y0)</span></code> and <code class="docutils literal notranslate"><span class="pre">(x1,y1)</span></code> (in this case, <code class="docutils literal notranslate"><span class="pre">x0</span></code> and <code class="docutils literal notranslate"><span class="pre">x1</span></code> = <code class="docutils literal notranslate"><span class="pre">barMids</span></code>). The <code class="docutils literal notranslate"><span class="pre">ang=90</span></code> directive plots the arrow as a flat line by setting the arrow’s angle (see what happens when you run the same pair of commands, but with <code class="docutils literal notranslate"><span class="pre">ang=50</span></code>, or <code class="docutils literal notranslate"><span class="pre">ang=110</span></code>). The <code class="docutils literal notranslate"><span class="pre">code=3</span></code> directive plots both “arrow” heads, not just start or end ones (try <code class="docutils literal notranslate"><span class="pre">code=1</span></code> or <code class="docutils literal notranslate"><span class="pre">code=2</span></code> instead and see what happens).</p>
<p>Now,</p>
<p><span class="math notranslate nohighlight">\(\star\)</span> Add all the lines of code from this section into your script. Run it and check you get the graph above.</p>
<p><span class="math notranslate nohighlight">\(\star\)</span> Use the second two chunks as a model to plot a similar graph for <code class="docutils literal notranslate"><span class="pre">GroundDwelling</span></code>. You should get something like the plot below.</p>
<hr class="docutils" />
<a class="reference internal image-reference" href="../_images/GDbarplot.png"><img alt="../_images/GDbarplot.png" src="../_images/GDbarplot.png" style="width: 400px;" /></a>
</section>
<hr class="docutils" />
<section id="an-alternative-to-barplots">
<h3>An alternative to barplots<a class="headerlink" href="#an-alternative-to-barplots" title="Permalink to this heading">#</a></h3>
<p>That is a lot of work to go through for a plot. Doing it the hard way uses some useful tricks, but one strength of R is that there is a huge list of add-on packages that you can use to get new functions that other people have written.</p>
<p>We will use the <code class="docutils literal notranslate"><span class="pre">gplots</span></code> package to create plots of group means and confidence intervals. Rather than plotting the means <span class="math notranslate nohighlight">\(\pm\)</span> 1 standard error, the option <code class="docutils literal notranslate"><span class="pre">p=0.95</span></code> uses the standard error and the number of data points to get 95% confidence intervals. The default <code class="docutils literal notranslate"><span class="pre">connect=TRUE</span></code> option adds a line connecting the means, which isn’t useful here.</p>
<p><span class="math notranslate nohighlight">\(\star\)</span> Replicate the code below into your script and run it to get the plots below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#Load the gplots package</span>
<span class="nf">library</span><span class="p">(</span><span class="n">gplots</span><span class="p">)</span>

<span class="c1"># Get plots of group means and standard errors</span>
<span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">))</span>
<span class="nf">plotmeans</span><span class="p">(</span><span class="n">logCvalue</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">TrophicLevel</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">mammals</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="o">=</span><span class="m">0.95</span><span class="p">,</span><span class="w"> </span><span class="n">connect</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>
<span class="nf">plotmeans</span><span class="p">(</span><span class="n">logCvalue</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">GroundDwelling</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">mammals</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="o">=</span><span class="m">0.95</span><span class="p">,</span><span class="w"> </span><span class="n">connect</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/fd9e17df73c32564f3a033bc1698f2592234c87c47faf8a4c6f8acb03dfda4e3.png" src="../_images/fd9e17df73c32564f3a033bc1698f2592234c87c47faf8a4c6f8acb03dfda4e3.png" />
</div>
</div>
</section>
</section>
<section id="analysis-of-variance">
<h2>Analysis of variance<a class="headerlink" href="#analysis-of-variance" title="Permalink to this heading">#</a></h2>
<p>Hopefully, those plots should convince you that there are differences in genome size between different trophic groups and between ground dwelling and other mammals. We’ll now use a linear model to test whether those differences are significant.</p>
<p><span class="math notranslate nohighlight">\(\star\)</span> Using code from the <a class="reference internal" href="14-regress.html"><span class="doc std std-doc">Regression chapter</span></a> as a guide, create a linear
model called <code class="docutils literal notranslate"><span class="pre">trophicLM</span></code> which models log C value as a function of trophic group.</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">anova</span></code> and <code class="docutils literal notranslate"><span class="pre">summary</span></code> to look at the analysis of variance table and then the coefficients of the model.</p>
<p>The ANOVA table for the model should look like the one below: trophic level explains highly significant variation in genome size (<span class="math notranslate nohighlight">\(F= 7.22, \textrm{df}=2 \textrm{ and } 300, p =0.0009\)</span>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">trophicLM</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">logCvalue</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">TrophicLevel</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">mammals</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">anova</span><span class="p">(</span><span class="n">trophicLM</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A anova: 2 × 5</caption>
<thead>
	<tr><th></th><th scope=col>Df</th><th scope=col>Sum Sq</th><th scope=col>Mean Sq</th><th scope=col>F value</th><th scope=col>Pr(&gt;F)</th></tr>
	<tr><th></th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>TrophicLevel</th><td>  2</td><td> 0.8268678</td><td>0.41343388</td><td>7.220365</td><td>0.0008657029</td></tr>
	<tr><th scope=row>Residuals</th><td>300</td><td>17.1778247</td><td>0.05725942</td><td>      NA</td><td>          NA</td></tr>
</tbody>
</table>
</div></div>
</div>
<p><em>Note the style of reporting the result</em> - the statistic (<span class="math notranslate nohighlight">\(F\)</span>), degrees of freedom and <span class="math notranslate nohighlight">\(p\)</span> value are all provided in support. A commonly used style is this: <span class="math notranslate nohighlight">\(F_{2,300}=7.22, p=0.0009\)</span>.</p>
<p>Pay close attention to the sum of squares column. Of a total of <span class="math notranslate nohighlight">\(17.18+0.83 = 18.01\)</span> units of sums of squares, only 0.83 are explained by trophic level: <span class="math notranslate nohighlight">\(0.83/18.01 \approx 0.046\)</span> or 4.6%. This ratio is called R<span class="math notranslate nohighlight">\(^2\)</span>, a measure of explanatory power, and shows that, although the model is very significant, it isn’t very explanatory. We care about explanatory power
or effect size, <code class="docutils literal notranslate"><span class="pre">*not*</span></code> <span class="math notranslate nohighlight">\(p\)</span> values.</p>
<p>The coefficients table for the model looks like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">summary</span><span class="p">(</span><span class="n">trophicLM</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
lm(formula = logCvalue ~ TrophicLevel, data = mammals)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.50378 -0.16350 -0.00379  0.15114  0.93130 

Coefficients:
                      Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)            1.08507    0.03351  32.383  &lt; 2e-16 ***
TrophicLevelHerbivore  0.11186    0.03958   2.826 0.005027 ** 
TrophicLevelOmnivore   0.15128    0.03985   3.796 0.000178 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.2393 on 300 degrees of freedom
  (76 observations deleted due to missingness)
Multiple R-squared:  0.04593,	Adjusted R-squared:  0.03956 
F-statistic:  7.22 on 2 and 300 DF,  p-value: 0.0008657
</pre></div>
</div>
</div>
</div>
<p>It shows the following:</p>
<ul class="simple">
<li><p>The reference level (or intercept) is for carnivores. Their mean genome size is significantly different from zero - this is not an exciting finding!</p></li>
<li><p>The mean genome size for both herbivores and omnivores are both significantly different from carnivores. Both larger in fact: herbivore mean genome size = <span class="math notranslate nohighlight">\(1.085 + 0.112 = 1.197\)</span> and omnivore mean genome size = <span class="math notranslate nohighlight">\(1.085 + 0.151 = 1.236\)</span>. These are the same group means we found above.</p></li>
<li><p>The R<span class="math notranslate nohighlight">\(^2\)</span> is shown and is the 4.6% we calculated above. The <em>adjusted</em> R<span class="math notranslate nohighlight">\(^2\)</span> reduces the raw R<span class="math notranslate nohighlight">\(^2\)</span> to account for the number of variables included in the model. That 4.6% would be even less impressive if we needed 6 explanatory variables to get it!</p></li>
<li><p>The <span class="math notranslate nohighlight">\(F\)</span> statistic, as in the ANOVA table above.</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(\star\)</span> Repeat the analysis of variance above to look at the effects of ground dwelling on genome size.</p>
<section id="model-criticism">
<h3>Model criticism<a class="headerlink" href="#model-criticism" title="Permalink to this heading">#</a></h3>
<p>The next question must be — and actually, we should do this before we go anywhere near the model summaries &amp;mdas ;, <em>is the model appropriate for the data</em>?</p>
<p><span class="math notranslate nohighlight">\(\star\)</span> Using the <a class="reference internal" href="14-regress.html"><span class="doc std std-doc">Regression Chapter</span></a> to guide you, get the four model diagnostic plots for the trophic level model on a single figure.</p>
<p>The four plots are shown below.</p>
<hr class="docutils" />
<a class="reference internal image-reference" href="../_images/modelDiag.svg"><img alt="../_images/modelDiag.svg" src="../_images/modelDiag.svg" width="600px" /></a>
<hr class="docutils" />
<p>Note that in a regression analysis, the predicted values from the fitted model take a range along the relationship <span class="math notranslate nohighlight">\(y=a + bx\)</span>. For ANOVA, there are only a few predicted values — one for each group mean. This means that the plots above look different but we are looking for the same things: is there constant variance at each fitted value and are the residuals normally distributed? The answer for this model looks to be yes.</p>
<p><span class="math notranslate nohighlight">\(\star\)</span> Check the ground dwelling model in the same way.</p>
</section>
<section id="testing-pairwise-differences-between-levels">
<span id="anova-ci"></span><h3>Testing pairwise differences between levels<a class="headerlink" href="#testing-pairwise-differences-between-levels" title="Permalink to this heading">#</a></h3>
<p>The one thing that the trophic level model does not tell us is whether there is a difference in genome size between omnivores and herbivores — both are compared to carnivores, but not to each other. This is because of the multiple pairwise testing problem mentioned in <a class="reference internal" href="13-t_F_tests.html"><span class="doc std std-doc">t &amp; F tests</span></a>: if you do lots of tests then you may find small <span class="math notranslate nohighlight">\(p\)</span> values by chance and say something important is going on when it is just random chance. This is called a false positive or Type I error.</p>
<p>With a 95% confidence interval, there is a 5% chance of a false positive <em>per test</em> but there are ways of getting a 5% chance across a set (or family) of tests. For linear models, we can use Tukey’s Honest Significant Difference test. We have to convert the <code class="docutils literal notranslate"><span class="pre">lm</span></code> object into an <code class="docutils literal notranslate"><span class="pre">aov</span></code> object first.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">TukeyTroph</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">TukeyHSD</span><span class="p">(</span><span class="nf">aov</span><span class="p">(</span><span class="n">trophicLM</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="n">TukeyTroph</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Tukey multiple comparisons of means
    95% family-wise confidence level

Fit: aov(formula = trophicLM)

$TrophicLevel
                          diff         lwr       upr     p adj
Herbivore-Carnivore 0.11186136  0.01863354 0.2050892 0.0138881
Omnivore-Carnivore  0.15128061  0.05741074 0.2451505 0.0005208
Omnivore-Herbivore  0.03941925 -0.03161080 0.1104493 0.3922731
</pre></div>
</div>
</div>
</div>
<p>The table shows the following:</p>
<ul class="simple">
<li><p>The differences between the three possible pairs and then the lower and
upper bounds of the 95% confidence interval for the difference and a <span class="math notranslate nohighlight">\(p\)</span>
value.</p></li>
<li><p>In each case, we want to know if the difference could be zero: does the
95% confidence interval for each pair include zero.</p></li>
<li><p>For the first two pairs, carnivores versus omnivores and herbivores, the confidence intervals do not include zero, so they are significantly different. For the comparison between herbivores and omnivores, the interval does include zero (difference = 0.039, 95% CI’s limits are -0.032 &amp; 0.110), so these groups are not significantly different.</p></li>
<li><p>The <span class="math notranslate nohighlight">\(p\)</span> values for the top two pairs are both larger (less significant) than in the summary table. The test has made it harder to find significant results.</p></li>
</ul>
<p>You can visualise these confidence intervals by plotting the Tukey test. You have to tweak the graphics parameters to get a clean plot though.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">par</span><span class="p">(</span><span class="n">las</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">mar</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="m">10</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">1</span><span class="p">))</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">TukeyTroph</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/76aa5132425c798e483fbec03050ad4eeee81c277e096471e758daaad872ca49.png" src="../_images/76aa5132425c798e483fbec03050ad4eeee81c277e096471e758daaad872ca49.png" />
</div>
</div>
<p>In the above plotting code, <code class="docutils literal notranslate"><span class="pre">las=1</span></code> makes the labels horizontal, while
<code class="docutils literal notranslate"><span class="pre">mar=c(4,10,3,1)</span></code> makes the left margin wider by specifying <code class="docutils literal notranslate"><span class="pre">(bottom,</span> <span class="pre">left,</span> <span class="pre">top,</span> <span class="pre">right)</span></code>.</p>
<p><span class="math notranslate nohighlight">\(\star\)</span> Include the Tukey test in your script for both the trophic level and ground
dwelling models.</p>
</section>
<section id="are-the-factors-independent">
<h3>Are the factors independent?<a class="headerlink" href="#are-the-factors-independent" title="Permalink to this heading">#</a></h3>
<p>We’ve looked at two models, using trophic level and ground dwelling. It is worth asking whether these are independent factors. What if, for example, our herbivores are all big, ground dwellers? This is important to know because otherwise, a two-way ANOVA would not be appropriate. We will look at interactions in the <a class="reference internal" href="17-MulExplInter.html"><span class="doc std std-doc">Multiple Explanatory Variables Chapter</span></a>.</p>
<p>OK, so we want to know whether the two factors are independent. This is a job for the <span class="math notranslate nohighlight">\(\chi^2\)</span> test!</p>
</section>
</section>
<section id="the-chi-square-test-and-count-data">
<h2>The Chi-square test and count data<a class="headerlink" href="#the-chi-square-test-and-count-data" title="Permalink to this heading">#</a></h2>
<p>The Chi-square test, also known as <span class="math notranslate nohighlight">\(\chi^{2}\)</span> test or chi-square test, is designed for scenarios where you want to statistically test how likely it is that an observed distribution of values is due to chance. It is also called a “goodness of fit” statistic, because it measures how well the observed distribution of data fits with the distribution that is expected if the variables of which measurements are made are independent. In our mammals example below, the two variables are trophic level and ground dwelling.</p>
<p>Note that a <span class="math notranslate nohighlight">\(\chi^{2}\)</span> test is designed to analyze categorical data. That is the data have been counted (count data) and divided into categories. It is not meant for continuous data (such as body weight, genome size, or height). For example, if you want to test whether
attending class influences how students perform on an exam, using test scores (from 0-100) as data would not be appropriate for a Chi-square test. However, arranging students into the categories “Pass” and “Fail” and counting up how many fall in each categories would be appropriate. Additionally, the data in a Chi-square table (see below) should not be in the form of percentages – only count data are allowed!</p>
<section id="the-chi-square-test-with-the-mammals-data">
<h3>The Chi-square test with the mammals data<a class="headerlink" href="#the-chi-square-test-with-the-mammals-data" title="Permalink to this heading">#</a></h3>
<p>We can easily build a table for a Chi-square test on the mammals data as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">factorTable</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">table</span><span class="p">(</span><span class="n">mammals</span><span class="o">$</span><span class="n">GroundDwelling</span><span class="p">,</span><span class="w"> </span><span class="n">mammals</span><span class="o">$</span><span class="n">TrophicLevel</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">factorTable</span><span class="p">)</span><span class="w"> </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     
      Carnivore Herbivore Omnivore
  No         26        45       64
  Yes        22        62       40
</pre></div>
</div>
</div>
</div>
<p>Now let’s run the test:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">chisq.test</span><span class="p">(</span><span class="n">factorTable</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	Pearson&#39;s Chi-squared test

data:  factorTable
X-squared = 8.1202, df = 2, p-value = 0.01725
</pre></div>
</div>
</div>
</div>
<p>The “X-squared” value is the <span class="math notranslate nohighlight">\(\chi^{2}\)</span> <em>test
statistic</em>, akin to the t-value of the t-test or W value in the
Wilcox test.</p>
<p>The <span class="math notranslate nohighlight">\(\chi^{2}\)</span> statistic is calculated as the sum of the quantity</p>
<div class="math notranslate nohighlight">
\[\frac{(\mathrm{Observed} - \mathrm{Expected})^2}{\mathrm{Expected}}\]</div>
<p>across all the cells/categories in the table (so the sum would be over 6 categories in our current mammals example).</p>
<p>“Observed” is the observed proportion of data that fall in a certain category. For example, there are 26 species observed in the <code class="docutils literal notranslate"><span class="pre">Carnivore</span></code>, <code class="docutils literal notranslate"><span class="pre">No</span></code> category, and 22 in the <code class="docutils literal notranslate"><span class="pre">Carnivore</span></code>, <code class="docutils literal notranslate"><span class="pre">Yes</span></code> category.</p>
<p>“Expected” is what count would be expected if the values in each category were truly independent. Each cell has its own expected value, which is simply calculated as the count one would expect in each category if the value were generated in proportion to the total number seen in that category. So in our example, the expected value for the <code class="docutils literal notranslate"><span class="pre">Carnivore</span></code>, <code class="docutils literal notranslate"><span class="pre">No</span></code> category would be</p>
<p><span class="math notranslate nohighlight">\(26+22 \mathrm{~(Total~number~of~carnivore~species)} \times \frac{26+45+64 \mathrm{~(Total~number~in~the~&quot;No&quot;~category)}}{26+22+45+62+64+40 \mathrm{~(Total~number~of~species)}} = 48 \times \frac{135}{259} = 25.02\)</span></p>
<p>The sum of all six (one for each cell in the table above) such calculations would be the <span class="math notranslate nohighlight">\(\chi^{2}\)</span> value that R gave you through the <code class="docutils literal notranslate"><span class="pre">chisq.test()</span></code> above — try it!</p>
<p>Now back to the R output from the <code class="docutils literal notranslate"><span class="pre">chisq.test()</span></code> above. Why df = 2? This is calculated as <span class="math notranslate nohighlight">\(DF = (r - 1) * (c - 1)\)</span> where <span class="math notranslate nohighlight">\(r\)</span> and <span class="math notranslate nohighlight">\(c\)</span> are the number of rows and columns in the <span class="math notranslate nohighlight">\(\chi^{2}\)</span> table, respectively. The same principle you learned before applies here; you lose one degree of freedom for each new level of information you need to estimate: there is uncertainity about the information (number of categories) in both rows and columns, so you need to lose one degree of freedom for each.</p>
<p>Finally, note that the p-value is significant — we can conclude that the factors aren’t independent. From the table, carnivores can be either ground dwelling or not, but herbivores tend to be ground dwelling and
omnivores tend not to be. Ah well… it’s OK. We will look at a better way to analyze these data using “interactions” <a class="reference internal" href="17-MulExplInter.html"><span class="doc std std-doc">later</span></a>.</p>
<p><span class="math notranslate nohighlight">\(\star\)</span> Include and run the <span class="math notranslate nohighlight">\(\chi^2\)</span> test in your script.</p>
</section>
</section>
<section id="saving-data">
<h2>Saving data<a class="headerlink" href="#saving-data" title="Permalink to this heading">#</a></h2>
<p>The last thing to do is to save a copy of the mammal data, including our new column of log data, for use in later chapters.</p>
<p><span class="math notranslate nohighlight">\(\star\)</span> Use this code in your script to create the saved data in your <code class="docutils literal notranslate"><span class="pre">Data</span></code> directory :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">save</span><span class="p">(</span><span class="n">mammals</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="o">=</span><span class="s">&#39;../data/mammals.Rdata&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p><a id="fn1"></a>
[1]: The helper script file is <code class="docutils literal notranslate"><span class="pre">anova.R</span></code></p>
<p><a id="fn2"></a>
[2]: That is, it is 1 minus the ratio of the square of the standard error of the estimate to the sample variance of the response</p>
<p><a id="fn3"></a>
[3]: i.e., Standard error of the estimate won’t decrease</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            name: "ir",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="14-regress.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Linear Models: Regression</p>
      </div>
    </a>
    <a class="right-next"
       href="16-MulExpl.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Linear Models: Multiple explanatory variables</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-anova">What is ANOVA?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-the-anova-test-statistic">Calculating the ANOVA test statistic</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#degrees-of-freedom">Degrees of freedom</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-f-value-or-ratio">The F-Value (or Ratio)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-r-2">The R<span class="math notranslate nohighlight">\(^2\)</span></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#adjusted-r-2">Adjusted R<span class="math notranslate nohighlight">\(^2\)</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#an-example-anova">An example ANOVA</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-data">The data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exploring-the-data-with-boxplots">Exploring the data with boxplots</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#differences-in-means-with-barplots">Differences in means with barplots</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#an-alternative-to-barplots">An alternative to barplots</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-of-variance">Analysis of variance</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-criticism">Model criticism</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-pairwise-differences-between-levels">Testing pairwise differences between levels</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#are-the-factors-independent">Are the factors independent?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-chi-square-test-and-count-data">The Chi-square test and count data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-chi-square-test-with-the-mammals-data">The Chi-square test with the mammals data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#saving-data">Saving data</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Samraat Pawar
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>